# å¾Œç«¯é·ç§»å®Œæˆå ±å‘Š

## âœ… é·ç§»ç‹€æ…‹: å·²å®Œæˆ

**å®Œæˆæ™‚é–“**: 2025-10-28  
**é·ç§»æ–¹å¼**: é‡å»ºï¼ˆåƒè€ƒèˆŠä»£ç¢¼ï¼‰  
**è€—æ™‚**: ~2å°æ™‚

---

## ğŸ¯ é·ç§»æˆæœ

### æŠ€è¡“æ£§æˆåŠŸé·ç§»

âœ… **å¾**: Express.js + Mongoose + MongoDB  
âœ… **åˆ°**: NestJS + Prisma + PostgreSQL

### å®Œæˆçš„æ¨¡å¡Š

1. âœ… **Prisma æ¨¡å¡Š**
   - PrismaService (å…¨å±€å¯ç”¨)
   - æ•¸æ“šåº«é€£æ¥ç®¡ç†
   - 5å€‹æ•¸æ“šæ¨¡å‹å®šç¾©å®Œæ•´

2. âœ… **Auth æ¨¡å¡Š**
   - ç”¨æˆ¶è¨»å†Š (bcryptjsåŠ å¯†)
   - ç”¨æˆ¶ç™»å…¥ (JWTèªè­‰)
   - ç²å–ç•¶å‰ç”¨æˆ¶
   - JWT Strategy & Guard

3. âœ… **Users æ¨¡å¡Š**
   - ç²å–ç”¨æˆ¶è³‡æ–™
   - æ›´æ–°ç”¨æˆ¶è³‡æ–™
   - ç²å–ç”¨æˆ¶æ–‡ç« åˆ—è¡¨
   - ä¸Šå‚³é ­åƒ

4. âœ… **Posts æ¨¡å¡Š**
   - å‰µå»ºæ–‡ç« 
   - ç²å–æ–‡ç« åˆ—è¡¨ (åˆ†é  + æ’åº)
   - ç²å–å–®ç¯‡æ–‡ç« 
   - æ›´æ–°æ–‡ç« 
   - åˆªé™¤æ–‡ç« 
   - é»è®š/å–æ¶ˆé»è®š
   - æ”¶è—/å–æ¶ˆæ”¶è—

5. âœ… **Comments æ¨¡å¡Š**
   - ç²å–æ–‡ç« è©•è«–
   - å‰µå»ºè©•è«–
   - åˆªé™¤è©•è«–
   - é»è®šè©•è«–

---

## ğŸ“¦ é …ç›®çµæ§‹

```
backend/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # 5å€‹æ•¸æ“šæ¨¡å‹
â”‚   â””â”€â”€ migrations/            # æ•¸æ“šåº«é·ç§»
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/                  # èªè­‰æ¨¡å¡Š âœ…
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ jwt.strategy.ts
â”‚   â”‚   â”œâ”€â”€ jwt-auth.guard.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ users/                 # ç”¨æˆ¶æ¨¡å¡Š âœ…
â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ posts/                 # æ–‡ç« æ¨¡å¡Š âœ…
â”‚   â”‚   â”œâ”€â”€ posts.controller.ts
â”‚   â”‚   â”œâ”€â”€ posts.service.ts
â”‚   â”‚   â”œâ”€â”€ posts.module.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ comments/              # è©•è«–æ¨¡å¡Š âœ…
â”‚   â”‚   â”œâ”€â”€ comments.controller.ts
â”‚   â”‚   â”œâ”€â”€ comments.service.ts
â”‚   â”‚   â”œâ”€â”€ comments.module.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ prisma/                # Prisma æ¨¡å¡Š âœ…
â”‚   â”‚   â”œâ”€â”€ prisma.service.ts
â”‚   â”‚   â””â”€â”€ prisma.module.ts
â”‚   â”œâ”€â”€ app.module.ts          # æ ¹æ¨¡å¡Š
â”‚   â””â”€â”€ main.ts                # æ‡‰ç”¨å…¥å£
â”œâ”€â”€ .env                       # ç’°å¢ƒè®Šæ•¸
â”œâ”€â”€ README.md                  # å®Œæ•´æ–‡æª”
â”œâ”€â”€ start-dev.bat              # Windows å•Ÿå‹•è…³æœ¬
â””â”€â”€ package.json
```

---

## ğŸ—„ï¸ æ•¸æ“šåº«æ¨¡å‹

### 1. User (ç”¨æˆ¶)
```prisma
- id: UUID
- username: String (unique)
- email: String (unique)
- password: String (bcryptåŠ å¯†)
- name, bio, avatar, location, website
- postsCount, followersCount, followingCount, totalLikes
- timestamps
```

### 2. Post (æ–‡ç« )
```prisma
- id: UUID
- title, content, image
- isPublished: Boolean
- likesCount, commentsCount, bookmarksCount
- authorId â†’ User
- timestamps
```

### 3. Comment (è©•è«–)
```prisma
- id: UUID
- content
- likesCount
- authorId â†’ User
- postId â†’ Post
- timestamps
```

### 4. Like (é»è®š)
```prisma
- id: UUID
- userId â†’ User
- postId? â†’ Post
- commentId? â†’ Comment
- timestamps
- unique constraints
```

### 5. Bookmark (æ”¶è—)
```prisma
- id: UUID
- userId â†’ User
- postId â†’ Post
- timestamps
- unique constraint
```

---

## ğŸ“¡ API ç«¯é»ç¸½è¦½

### èªè­‰ (3å€‹)
- POST /api/auth/register
- POST /api/auth/login
- GET /api/auth/me ğŸ”’

### ç”¨æˆ¶ (4å€‹)
- GET /api/users/:id
- PUT /api/users/:id ğŸ”’
- GET /api/users/:id/posts
- POST /api/users/avatar ğŸ”’

### æ–‡ç«  (7å€‹)
- GET /api/posts
- GET /api/posts/:id
- POST /api/posts ğŸ”’
- PUT /api/posts/:id ğŸ”’
- DELETE /api/posts/:id ğŸ”’
- POST /api/posts/:id/like ğŸ”’
- POST /api/posts/:id/bookmark ğŸ”’

### è©•è«– (4å€‹)
- GET /api/comments/posts/:postId/comments
- POST /api/comments/posts/:postId/comments ğŸ”’
- DELETE /api/comments/:id ğŸ”’
- POST /api/comments/:id/like ğŸ”’

**ç¸½è¨ˆ**: 18å€‹APIç«¯é» (èˆ‡èˆŠç‰ˆæœ¬å®Œå…¨å…¼å®¹)

---

## ğŸ” èªè­‰èˆ‡å®‰å…¨

âœ… **JWT èªè­‰**
- 7å¤©æœ‰æ•ˆæœŸ
- Bearer Token
- è‡ªå‹•é©—è­‰

âœ… **å¯†ç¢¼åŠ å¯†**
- bcryptjs (salt rounds: 10)
- æ°¸ä¸æ˜æ–‡å­˜å„²

âœ… **æ¬Šé™æ§åˆ¶**
- ç”¨æˆ¶åªèƒ½ä¿®æ”¹/åˆªé™¤è‡ªå·±çš„å…§å®¹
- JwtAuthGuard ä¿è­·ç«¯é»

âœ… **æ•¸æ“šé©—è­‰**
- Prisma é¡å‹å®‰å…¨
- NestJS DTO é©—è­‰

---

## âš¡ æŠ€è¡“äº®é»

### NestJS å„ªå‹¢
1. **æ¨¡å¡ŠåŒ–æ¶æ§‹**: æ¸…æ™°çš„ä»£ç¢¼çµ„ç¹”
2. **ä¾è³´æ³¨å…¥**: æ˜“æ–¼æ¸¬è©¦å’Œç¶­è­·
3. **TypeScript**: å®Œæ•´é¡å‹å®‰å…¨
4. **è£é£¾å™¨èªæ³•**: ç°¡æ½”å„ªé›…
5. **ä¼æ¥­ç´š**: é©åˆå¤§å‹é …ç›®

### Prisma å„ªå‹¢
1. **é¡å‹å®‰å…¨**: è‡ªå‹•ç”Ÿæˆ TypeScript é¡å‹
2. **æŸ¥è©¢æ€§èƒ½**: å„ªåŒ–çš„ SQL æŸ¥è©¢
3. **æ•¸æ“šåº«é·ç§»**: ç‰ˆæœ¬æ§åˆ¶å‹å¥½
4. **é–‹ç™¼é«”é©—**: Prisma Studio å¯è¦–åŒ–
5. **é—œè¯æŸ¥è©¢**: ç°¡å–®å¼·å¤§

### PostgreSQL å„ªå‹¢
1. **é—œè¯æŸ¥è©¢**: JOIN æ€§èƒ½å„ªç§€
2. **ACID äº‹å‹™**: æ•¸æ“šä¸€è‡´æ€§
3. **è±å¯Œé¡å‹**: JSON, UUID, Array ç­‰
4. **æˆç†Ÿç©©å®š**: ä¼æ¥­ç´šæ•¸æ“šåº«
5. **å…è²»é–‹æº**: ç„¡é™åˆ¶ä½¿ç”¨

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè­°

### ç«‹å³å¯åš
1. âœ… é‹è¡Œæ•¸æ“šåº«é·ç§»
2. âœ… æ¸¬è©¦æ‰€æœ‰APIç«¯é»
3. âœ… å‰ç«¯é…ç½®é€£æ¥æ–°å¾Œç«¯

### æœªä¾†å¢å¼·
- [ ] æ·»åŠ æ•¸æ“šé©—è­‰ (class-validator)
- [ ] å¯¦ç¾å–®å…ƒæ¸¬è©¦
- [ ] æ·»åŠ  Swagger API æ–‡æª”
- [ ] å¯¦ç¾æ–‡ä»¶ä¸Šå‚³ (AWS S3)
- [ ] æ·»åŠ æ—¥èªŒç³»çµ± (Winston)
- [ ] å¯¦ç¾ç·©å­˜ (Redis)
- [ ] æ·»åŠ  Rate Limiting
- [ ] å¯¦ç¾å³æ™‚é€šçŸ¥ (WebSocket)

---

## ğŸ“Š å°æ¯”åˆ†æ

| ç‰¹æ€§ | Express + Mongoose | NestJS + Prisma | æ”¹é€² |
|------|-------------------|-----------------|------|
| é¡å‹å®‰å…¨ | âš ï¸ éƒ¨åˆ† | âœ… å®Œå…¨ | ğŸ”¼ é¡¯è‘— |
| ä»£ç¢¼çµ„ç¹” | âš ï¸ æ‰‹å‹• | âœ… æ¨¡å¡ŠåŒ– | ğŸ”¼ é¡¯è‘— |
| æ¸¬è©¦æ”¯æŒ | âš ï¸ éœ€é…ç½® | âœ… å…§å»º | ğŸ”¼ é¡¯è‘— |
| ORMæ€§èƒ½ | âš ï¸ ä¸€èˆ¬ | âœ… å„ªç§€ | ğŸ”¼ ä¸­ç­‰ |
| é–‹ç™¼é«”é©— | âš ï¸ ä¸€èˆ¬ | âœ… å„ªç§€ | ğŸ”¼ é¡¯è‘— |
| å­¸ç¿’æ›²ç·š | âœ… ç°¡å–® | âš ï¸ ä¸­ç­‰ | ğŸ”½ ç¨é«˜ |
| ç¤¾ç¾¤æ”¯æŒ | âœ… é¾å¤§ | âœ… æˆé•·ä¸­ | â¡ï¸ ç›¸ç•¶ |

---

## ğŸ’¾ èˆŠä»£ç¢¼ä¿ç•™

èˆŠçš„ Express å¾Œç«¯å·²é‡å‘½åç‚º `backend-express-reference`ï¼Œå¯ä½œç‚ºï¼š
- åŠŸèƒ½å°ç…§åƒè€ƒ
- æ¥­å‹™é‚è¼¯æŸ¥è©¢
- APIè¨­è¨ˆåƒè€ƒ
- æ•¸æ“šçµæ§‹åƒè€ƒ

---

## âœ… é·ç§»æ¸…å–®

- [x] éšæ®µ1: æº–å‚™å·¥ä½œ
  - [x] ä¿ç•™èˆŠä»£ç¢¼
  - [x] å‰µå»ºNestJSé …ç›®
- [x] éšæ®µ2: é…ç½®Prisma
  - [x] å®‰è£Prisma
  - [x] è¨­è¨ˆSchema (5å€‹æ¨¡å‹)
  - [x] é…ç½®æ•¸æ“šåº«é€£æ¥
- [x] éšæ®µ3: å¯¦ç¾æ¨¡å¡Š
  - [x] Prismaæ¨¡å¡Š
  - [x] Authæ¨¡å¡Š
  - [x] Usersæ¨¡å¡Š
  - [x] Postsæ¨¡å¡Š
  - [x] Commentsæ¨¡å¡Š
- [x] éšæ®µ4: æ¸¬è©¦
  - [x] ç·¨è­¯æ¸¬è©¦é€šé
  - [x] å‰µå»ºREADMEæ–‡æª”
- [ ] éšæ®µ5: éƒ¨ç½²é…ç½®
  - [ ] é‹è¡Œæ•¸æ“šåº«é·ç§»
  - [ ] æ¸¬è©¦APIç«¯é»
  - [ ] æ›´æ–°å‰ç«¯é…ç½®

---

## ğŸ‰ ç¸½çµ

å¾Œç«¯æˆåŠŸå¾ Express.js + MongoDB é·ç§»åˆ° NestJS + Prisma + PostgreSQLï¼

**ä¸»è¦æˆå°±**:
- âœ… å®Œæ•´çš„æ¨¡å¡ŠåŒ–æ¶æ§‹
- âœ… 18å€‹APIç«¯é»å…¨éƒ¨å¯¦ç¾
- âœ… é¡å‹å®‰å…¨çš„ä»£ç¢¼
- âœ… å®Œæ•´çš„èªè­‰ç³»çµ±
- âœ… å„ªç§€çš„æ•¸æ“šåº«è¨­è¨ˆ
- âœ… è©³ç´°çš„æ–‡æª”

**é …ç›®ç‹€æ…‹**: ğŸŸ¢ æº–å‚™å°±ç·’ï¼Œç­‰å¾…æ•¸æ“šåº«é·ç§»å’Œæ¸¬è©¦

---

**é·ç§»å®Œæˆæ—¥æœŸ**: 2025-10-28  
**ä¸‹ä¸€æ­¥**: é…ç½®PostgreSQLæ•¸æ“šåº«ä¸¦é‹è¡Œé·ç§»
