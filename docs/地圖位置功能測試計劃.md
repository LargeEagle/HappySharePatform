# 地圖及位置功能測試計劃

## 測試日期: 2025-11-03

---

## 📋 測試概覽

### 測試範圍
本次測試涵蓋社交媒體平台的地圖及位置功能，包括：
- Phase 1: 基礎位置功能
- Phase 2: 搜尋與篩選
- Phase 3: 地圖視圖

### 測試環境
- **平台**: React Native (iOS/Android)
- **地圖服務**: Google Maps API
- **定位服務**: Expo Location
- **測試數據**: Mock 數據 (台北地區地標)

---

## 🧪 Phase 1: 基礎位置功能測試

### 1.1 LocationPicker 組件測試

#### 測試場景 1: 打開位置選擇器
**步驟**:
1. 進入 CreatePostScreen
2. 點擊「📍 添加位置」按鈕
3. 觀察 LocationPicker Modal 是否正確顯示

**預期結果**:
- ✅ Modal 正確彈出
- ✅ 顯示地圖視圖
- ✅ 顯示搜尋框
- ✅ 顯示「獲取當前位置」按鈕
- ✅ 顯示「確認」和「取消」按鈕

#### 測試場景 2: 地址搜尋功能
**步驟**:
1. 在搜尋框輸入「台北101」
2. 點擊搜尋或按下 Enter
3. 觀察地圖是否移動到該位置

**預期結果**:
- ✅ 地圖中心移動到搜尋位置
- ✅ 標記顯示在該位置
- ✅ 顯示地址信息
- ✅ 顯示地點名稱

#### 測試場景 3: GPS 定位功能
**步驟**:
1. 點擊「獲取當前位置」按鈕
2. 授予位置權限（如果首次使用）
3. 觀察是否獲取到位置

**預期結果**:
- ✅ 請求位置權限
- ✅ 顯示載入狀態
- ✅ 地圖移動到當前位置
- ✅ 顯示當前位置的地址信息
- ✅ 標記放置在當前位置

#### 測試場景 4: 地圖點擊選點
**步驟**:
1. 在地圖上任意位置點擊
2. 觀察標記是否移動
3. 檢查地址信息是否更新

**預期結果**:
- ✅ 標記移動到點擊位置
- ✅ 執行反向地理編碼
- ✅ 顯示新位置的地址
- ✅ 地址信息即時更新

#### 測試場景 5: 拖曳標記
**步驟**:
1. 按住標記並拖曳到新位置
2. 釋放標記
3. 觀察地址更新

**預期結果**:
- ✅ 標記可以被拖曳
- ✅ 拖曳過程流暢
- ✅ 釋放後執行反向地理編碼
- ✅ 地址信息更新

#### 測試場景 6: 確認位置選擇
**步驟**:
1. 選擇任意位置
2. 點擊「確認」按鈕
3. 觀察 CreatePostScreen

**預期結果**:
- ✅ Modal 關閉
- ✅ 返回 CreatePostScreen
- ✅ 顯示 MapPreview 組件
- ✅ 按鈕文字變更為「✓ 已添加位置」

### 1.2 MapPreview 組件測試

#### 測試場景 7: 位置預覽顯示
**步驟**:
1. 在 CreatePostScreen 添加位置後
2. 觀察 MapPreview 顯示

**預期結果**:
- ✅ 顯示小型地圖
- ✅ 地圖上有標記
- ✅ 顯示位置信息卡片
- ✅ 顯示地點名稱
- ✅ 顯示地址
- ✅ 顯示城市

#### 測試場景 8: 編輯位置
**步驟**:
1. 點擊 MapPreview
2. 觀察是否重新打開 LocationPicker

**預期結果**:
- ✅ LocationPicker 重新打開
- ✅ 顯示之前選擇的位置
- ✅ 可以修改位置
- ✅ 確認後更新預覽

#### 測試場景 9: 移除位置
**步驟**:
1. 點擊 MapPreview 上的移除按鈕
2. 觀察變化

**預期結果**:
- ✅ MapPreview 消失
- ✅ 按鈕恢復為「📍 添加位置」
- ✅ 位置數據被清除

### 1.3 CreatePostScreen 集成測試

#### 測試場景 10: 發布帶位置的文章
**步驟**:
1. 填寫標題和內容
2. 添加位置
3. 點擊「發布」
4. 檢查是否成功

**預期結果**:
- ✅ 文章成功發布
- ✅ 位置數據包含在請求中
- ✅ 跳轉到 HomeScreen
- ✅ 顯示成功提示

#### 測試場景 11: 保存帶位置的草稿
**步驟**:
1. 填寫內容並添加位置
2. 點擊「保存草稿」
3. 重新進入 CreatePostScreen
4. 檢查草稿是否包含位置

**預期結果**:
- ✅ 草稿保存成功
- ✅ 重新進入時載入草稿
- ✅ 位置信息被恢復
- ✅ MapPreview 正確顯示

### 1.4 PostDetailScreen 顯示測試

#### 測試場景 12: 查看帶位置的文章
**步驟**:
1. 點擊任一帶位置的文章
2. 進入 PostDetailScreen
3. 滾動到位置區域

**預期結果**:
- ✅ 顯示 MapPreview
- ✅ 地圖高度為 200px
- ✅ 標記正確顯示
- ✅ 位置信息正確顯示

---

## 🔍 Phase 2: 搜尋與篩選測試

### 2.1 LocationFilter 組件測試

#### 測試場景 13: 打開位置篩選器
**步驟**:
1. 在 HomeScreen
2. 點擊「📍」篩選按鈕
3. 觀察 LocationFilter Modal

**預期結果**:
- ✅ Modal 正確彈出
- ✅ 顯示「啟用位置篩選」開關
- ✅ 顯示「使用我的當前位置」按鈕
- ✅ 顯示操作按鈕（重置/取消/套用）

#### 測試場景 14: 啟用位置篩選
**步驟**:
1. 開啟「啟用位置篩選」開關
2. 觀察 UI 變化

**預期結果**:
- ✅ 顯示位置狀態區域
- ✅ 顯示「尚未設定位置」
- ✅ 啟用「使用我的當前位置」按鈕
- ✅ 顯示半徑選擇器

#### 測試場景 15: 獲取當前位置
**步驟**:
1. 點擊「使用我的當前位置」
2. 授予權限
3. 等待定位完成

**預期結果**:
- ✅ 顯示載入指示器
- ✅ 請求位置權限
- ✅ 獲取當前位置
- ✅ 顯示位置信息
- ✅ 顯示城市和地址

#### 測試場景 16: 選擇搜尋半徑
**步驟**:
1. 獲取位置後
2. 點擊不同的半徑選項（1km, 5km, 10km, 20km, 50km）
3. 觀察半徑值變化

**預期結果**:
- ✅ SegmentedButtons 正確顯示
- ✅ 選中狀態正確切換
- ✅ 半徑值正確更新
- ✅ 顯示選中的半徑數值

#### 測試場景 17: 套用位置篩選
**步驟**:
1. 設定位置和半徑
2. 點擊「套用」按鈕
3. 觀察 HomeScreen 變化

**預期結果**:
- ✅ Modal 關閉
- ✅ 文章列表重新載入
- ✅ 只顯示半徑內的文章
- ✅ 「附近」排序選項啟用
- ✅ 「📍」按鈕變為實心圖標

#### 測試場景 18: 重置篩選
**步驟**:
1. 套用篩選後
2. 重新打開 LocationFilter
3. 點擊「重置」按鈕

**預期結果**:
- ✅ 位置篩選關閉
- ✅ 位置被清除
- ✅ 半徑恢復為 10km
- ✅ UI 恢復初始狀態

### 2.2 距離計算測試

#### 測試場景 19: 距離顯示準確性
**測試數據**:
- 台北 101 (25.0330, 121.5654)
- 淡水漁人碼頭 (25.0478, 121.5170)
- 預期距離: ~22km

**步驟**:
1. 設定位置為台北 101 附近
2. 套用篩選
3. 查看淡水文章的距離

**預期結果**:
- ✅ 距離計算正確（誤差 < 5%）
- ✅ 距離格式正確顯示

#### 測試場景 20: 距離格式化測試
**測試案例**:
- 500m → "500m"
- 2.5km → "2.5km"
- 15.8km → "16km"

**預期結果**:
- ✅ < 1km 顯示米
- ✅ 1-10km 顯示一位小數
- ✅ > 10km 顯示整數

### 2.3 HomeScreen 排序測試

#### 測試場景 21: 三種排序模式切換
**步驟**:
1. 點擊「最新」→ 觀察順序
2. 點擊「熱門」→ 觀察順序
3. 套用位置篩選
4. 點擊「附近」→ 觀察順序

**預期結果**:
- ✅ 最新: 按發布時間降序
- ✅ 熱門: 按讚數降序
- ✅ 附近: 按距離升序
- ✅ 未啟用位置時「附近」禁用

#### 測試場景 22: PostCard 距離顯示
**步驟**:
1. 啟用位置篩選
2. 選擇「附近」排序
3. 查看文章卡片

**預期結果**:
- ✅ 右上角顯示距離
- ✅ 顯示地圖圖標
- ✅ 距離格式正確
- ✅ 顏色為主題色

---

## 🗺️ Phase 3: 地圖視圖測試

### 3.1 MapSearchScreen 基本功能

#### 測試場景 23: 進入地圖搜尋
**步驟**:
1. 在 HomeScreen
2. 點擊「地圖」按鈕
3. 觀察 MapSearchScreen

**預期結果**:
- ✅ 導航到 MapSearchScreen
- ✅ 顯示完整地圖視圖
- ✅ 顯示頂部工具欄
- ✅ 請求位置權限

#### 測試場景 24: 地圖初始化
**步驟**:
1. 授予位置權限
2. 等待地圖載入

**預期結果**:
- ✅ 地圖以當前位置為中心
- ✅ 顯示用戶位置藍點
- ✅ 開始載入附近文章
- ✅ 顯示載入指示器

#### 測試場景 25: 文章標記顯示
**步驟**:
1. 等待文章載入完成
2. 觀察地圖上的標記

**預期結果**:
- ✅ 所有有位置的文章顯示標記
- ✅ 標記位置正確
- ✅ 標記數量與 Chip 顯示一致
- ✅ 標記可以點擊

#### 測試場景 26: 點擊標記查看預覽
**步驟**:
1. 點擊任一標記
2. 觀察 Modal 彈出

**預期結果**:
- ✅ Modal 正確彈出
- ✅ 顯示完整 PostCard
- ✅ 包含距離信息
- ✅ 可以點擊卡片導航

#### 測試場景 27: 拖動地圖重新載入
**步驟**:
1. 拖動地圖到新區域
2. 釋放地圖
3. 觀察是否重新載入

**預期結果**:
- ✅ 地圖可以流暢拖動
- ✅ 釋放後觸發重新載入
- ✅ 顯示載入指示器
- ✅ 載入新區域的文章
- ✅ 更新標記顯示
- ✅ 更新文章數量

### 3.2 地圖/列表視圖切換

#### 測試場景 28: 切換到列表視圖
**步驟**:
1. 在地圖視圖
2. 點擊列表圖標按鈕
3. 觀察視圖變化

**預期結果**:
- ✅ 視圖切換到列表
- ✅ 顯示文章卡片列表
- ✅ 每張卡片顯示距離
- ✅ 按鈕圖標變為地圖圖標
- ✅ FAB 消失

#### 測試場景 29: 列表視圖互動
**步驟**:
1. 在列表視圖
2. 滾動列表
3. 點擊任一文章卡片

**預期結果**:
- ✅ 列表可以流暢滾動
- ✅ 顯示所有文章
- ✅ 點擊導航到 PostDetailScreen
- ✅ 正確傳遞 postId

#### 測試場景 30: 切換回地圖視圖
**步驟**:
1. 在列表視圖
2. 點擊地圖圖標按鈕
3. 觀察視圖變化

**預期結果**:
- ✅ 視圖切換回地圖
- ✅ 保持之前的地圖位置
- ✅ 標記仍然顯示
- ✅ 按鈕圖標變為列表圖標
- ✅ FAB 重新顯示

### 3.3 GPS 定位功能

#### 測試場景 31: 回到當前位置
**步驟**:
1. 拖動地圖到遠離當前位置
2. 點擊 FAB（GPS 按鈕）
3. 觀察地圖變化

**預期結果**:
- ✅ 地圖動畫移動到當前位置
- ✅ 保持適當的縮放級別
- ✅ 重新載入該區域文章
- ✅ 更新標記顯示

#### 測試場景 32: 未授權位置時的處理
**步驟**:
1. 拒絕位置權限
2. 點擊 GPS 按鈕
3. 觀察行為

**預期結果**:
- ✅ 請求權限
- ✅ 如果拒絕，顯示提示
- ✅ 不會崩潰
- ✅ 優雅降級

### 3.4 載入與狀態管理

#### 測試場景 33: 載入狀態顯示
**步驟**:
1. 觸發文章載入
2. 觀察載入指示器

**預期結果**:
- ✅ 地圖視圖: 頂部浮動卡片
- ✅ 列表視圖: 中央指示器
- ✅ 顯示「載入中...」文字
- ✅ 載入完成後消失

#### 測試場景 34: 空狀態處理
**步驟**:
1. 移動到沒有文章的區域
2. 觀察顯示

**預期結果**:
- ✅ 列表視圖顯示空狀態
- ✅ 顯示提示文字
- ✅ 建議操作提示
- ✅ 不會顯示錯誤

#### 測試場景 35: 文章數量更新
**步驟**:
1. 拖動地圖到不同區域
2. 觀察 Chip 數字變化

**預期結果**:
- ✅ 數字即時更新
- ✅ 反映當前顯示的文章數
- ✅ 數字正確

---

## 🔐 權限處理測試

### 測試場景 36: 首次使用 - iOS
**步驟**:
1. 首次打開應用
2. 嘗試使用位置功能
3. 觀察權限請求

**預期結果**:
- ✅ 顯示 iOS 系統權限彈窗
- ✅ 說明文字清晰
- ✅ 允許/拒絕都能正確處理

### 測試場景 37: 首次使用 - Android
**步驟**:
1. 首次打開應用
2. 嘗試使用位置功能
3. 觀察權限請求

**預期結果**:
- ✅ 顯示 Android 系統權限彈窗
- ✅ 說明文字清晰
- ✅ 允許/拒絕都能正確處理

### 測試場景 38: 拒絕權限後的體驗
**步驟**:
1. 拒絕位置權限
2. 嘗試使用需要位置的功能
3. 觀察應用行為

**預期結果**:
- ✅ 顯示友好的錯誤提示
- ✅ 提供前往設定的指引
- ✅ 不會崩潰
- ✅ 其他功能仍可使用

---

## 📱 跨平台兼容性測試

### iOS 測試

#### 測試場景 39: iOS 地圖渲染
**預期結果**:
- ✅ 地圖流暢渲染
- ✅ 標記正確顯示
- ✅ 互動響應正常
- ✅ 無性能問題

#### 測試場景 40: iOS 位置服務
**預期結果**:
- ✅ GPS 定位準確
- ✅ 反向地理編碼正常
- ✅ 權限請求正確
- ✅ 後台定位處理

### Android 測試

#### 測試場景 41: Android 地圖渲染
**預期結果**:
- ✅ 地圖流暢渲染
- ✅ 標記正確顯示
- ✅ 互動響應正常
- ✅ 無性能問題

#### 測試場景 42: Android 位置服務
**預期結果**:
- ✅ GPS 定位準確
- ✅ 反向地理編碼正常
- ✅ 權限請求正確
- ✅ 後台定位處理

---

## 🚀 性能測試

### 測試場景 43: 多標記渲染性能
**測試條件**:
- 50 個文章標記同時顯示

**預期結果**:
- ✅ FPS 保持在 30+ 
- ✅ 地圖拖動流暢
- ✅ 標記顯示無延遲
- ✅ 內存使用合理

### 測試場景 44: 快速拖動地圖
**步驟**:
1. 快速連續拖動地圖
2. 觀察載入行為

**預期結果**:
- ✅ 載入請求正確防抖
- ✅ 不會發送過多請求
- ✅ 載入指示器正確顯示
- ✅ 地圖保持流暢

### 測試場景 45: 視圖切換性能
**步驟**:
1. 快速切換地圖/列表視圖
2. 觀察性能

**預期結果**:
- ✅ 切換無延遲
- ✅ 動畫流暢
- ✅ 數據正確顯示
- ✅ 無閃爍

---

## 🐛 錯誤處理測試

### 測試場景 46: 網絡錯誤
**步驟**:
1. 斷開網絡
2. 嘗試載入文章或地理編碼

**預期結果**:
- ✅ 顯示錯誤提示
- ✅ 提供重試選項
- ✅ 不會崩潰
- ✅ 已載入數據保留

### 測試場景 47: API 錯誤
**步驟**:
1. 模擬 API 錯誤響應
2. 觀察錯誤處理

**預期結果**:
- ✅ 顯示友好錯誤信息
- ✅ 記錄錯誤日誌
- ✅ 不影響其他功能
- ✅ 提供降級方案

### 測試場景 48: 地理編碼失敗
**步驟**:
1. 觸發反向地理編碼
2. 模擬失敗情況

**預期結果**:
- ✅ 顯示座標而非地址
- ✅ 功能繼續可用
- ✅ 不會崩潰
- ✅ 提供重試選項

---

## 📊 測試結果統計

### 預期測試覆蓋率
- **單元測試**: 80%+
- **集成測試**: 90%+
- **UI 測試**: 100%
- **E2E 測試**: 主要流程 100%

### 關鍵指標
- **性能**: FPS ≥ 30, 記憶體 < 200MB
- **準確性**: 距離計算誤差 < 5%
- **可用性**: 所有功能可正常使用
- **穩定性**: 無崩潰，錯誤率 < 0.1%

---

## 📝 測試執行記錄

### 測試環境設置
```bash
# 安裝依賴
npm install

# 啟動開發伺服器
npm start

# iOS 模擬器
npm run ios

# Android 模擬器
npm run android
```

### 測試數據位置
```typescript
// 測試數據 (dummyData.ts)
台北 101: (25.0330, 121.5654)
淡水漁人碼頭: (25.0478, 121.5170)
大安森林公園: (25.0420, 121.5620)
東區咖啡廳: (25.0340, 121.5430)
信義區美食街: (25.0375, 121.5635)
```

---

## ✅ 測試檢查清單

### Phase 1: 基礎位置功能
- [ ] LocationPicker 所有功能正常
- [ ] MapPreview 顯示正確
- [ ] CreatePostScreen 集成完整
- [ ] PostDetailScreen 顯示正確
- [ ] 草稿系統支持位置
- [ ] 權限處理正確

### Phase 2: 搜尋與篩選
- [ ] LocationFilter 功能完整
- [ ] 距離計算準確
- [ ] 距離格式化正確
- [ ] HomeScreen 排序正常
- [ ] PostCard 距離顯示正確
- [ ] 篩選邏輯正確

### Phase 3: 地圖視圖
- [ ] MapSearchScreen 渲染正常
- [ ] 標記顯示正確
- [ ] 地圖互動流暢
- [ ] 列表視圖正常
- [ ] 視圖切換無問題
- [ ] GPS 定位功能正常
- [ ] 載入狀態正確
- [ ] 錯誤處理完善

### 跨平台
- [ ] iOS 所有功能正常
- [ ] Android 所有功能正常
- [ ] 性能達標
- [ ] UI/UX 一致

### 整合
- [ ] 所有功能協同工作
- [ ] 數據流正確
- [ ] 導航正常
- [ ] 無崩潰或重大 bug

---

## 🎯 優先級

### P0 (必須修復)
- 崩潰問題
- 數據丟失
- 功能完全無法使用

### P1 (高優先級)
- 性能問題
- 準確性問題
- 用戶體驗問題

### P2 (中優先級)
- UI 小問題
- 邊緣情況
- 優化建議

### P3 (低優先級)
- 文案優化
- 小細節調整
- 未來增強功能

---

## 📅 測試時間表

1. **功能測試**: 2-3 小時
2. **性能測試**: 1 小時
3. **跨平台測試**: 2 小時
4. **錯誤處理測試**: 1 小時
5. **回歸測試**: 1 小時

**總計**: 約 7-9 小時

---

## 👥 測試人員

- **開發者測試**: 完成所有功能開發和初步測試
- **QA 測試**: 執行完整測試計劃
- **用戶測試**: Beta 測試，收集反饋

---

## 📄 測試報告模板

```
測試場景: [場景編號] - [場景名稱]
測試日期: YYYY-MM-DD
測試人員: [姓名]
測試環境: [iOS/Android] - [版本]

步驟:
1. [步驟1]
2. [步驟2]
...

實際結果:
[描述實際觀察到的結果]

預期結果:
[描述預期的結果]

狀態: ✅ 通過 / ❌ 失敗 / ⚠️ 部分通過

截圖/錄屏:
[附加截圖或錄屏]

備註:
[任何額外的觀察或建議]
```

---

## 🔄 持續測試

### 自動化測試
- 單元測試: Jest
- UI 測試: React Native Testing Library
- E2E 測試: Detox

### CI/CD 集成
- 每次 PR 自動運行測試
- 部署前完整測試
- 性能監控

---

**測試計劃版本**: 1.0  
**最後更新**: 2025-11-03  
**狀態**: 待執行 ⏳
