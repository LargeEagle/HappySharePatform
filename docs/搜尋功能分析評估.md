# æœå°‹åŠŸèƒ½åˆ†æè©•ä¼°æ–‡æª”

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½ç›®æ¨™
ç‚º HAPPY SHARE ç¤¾äº¤å¹³å°æ·»åŠ å…¨é¢çš„æœå°‹åŠŸèƒ½ï¼Œè®“ç”¨æˆ¶èƒ½å¤ å¿«é€Ÿæ‰¾åˆ°æ„Ÿèˆˆè¶£çš„å…§å®¹ã€ç”¨æˆ¶å’Œè©±é¡Œã€‚

### 1.2 æ ¸å¿ƒåƒ¹å€¼
- **å…§å®¹ç™¼ç¾**ï¼šå¹«åŠ©ç”¨æˆ¶ç™¼ç¾æ–°çš„æœ‰è¶£å…§å®¹
- **ç”¨æˆ¶é€£æ¥**ï¼šä¿ƒé€²ç”¨æˆ¶ä¹‹é–“çš„äº’å‹•å’Œé—œæ³¨
- **æå‡åƒèˆ‡åº¦**ï¼šå¢åŠ ç”¨æˆ¶åœ¨å¹³å°çš„æ´»èºæ™‚é–“
- **æ”¹å–„é«”é©—**ï¼šæä¾›æ›´ä¾¿æ·çš„å°èˆªå’Œå…§å®¹è¨ªå•

## 2. åŠŸèƒ½ç¯„åœåˆ†æ

### 2.1 æœå°‹å°è±¡

#### 2.1.1 æ–‡ç« æœå°‹ (Posts Search) - å„ªå…ˆç´šï¼šâ­â­â­â­â­
**æœå°‹æ¬„ä½ï¼š**
- `title` - æ–‡ç« æ¨™é¡Œï¼ˆä¸»è¦ï¼‰
- `content` - æ–‡ç« å…§å®¹ï¼ˆæ¬¡è¦ï¼‰
- `authorId` - ä½œè€…ï¼ˆé—œè¯æœå°‹ï¼‰

**æœå°‹æ¢ä»¶ï¼š**
- é—œéµå­—åŒ¹é…ï¼ˆæ¨™é¡Œã€å…§å®¹ï¼‰
- ä½œè€…ç¯©é¸
- æ™‚é–“ç¯„åœç¯©é¸
- ç™¼å¸ƒç‹€æ…‹ç¯©é¸ï¼ˆå·²ç™¼å¸ƒ vs è‰ç¨¿ï¼‰
- ç†±é–€åº¦æ’åºï¼ˆlikesCount, commentsCountï¼‰
- æ™‚é–“æ’åºï¼ˆæœ€æ–°ã€æœ€æ—©ï¼‰

**å¯¦ç¾è¤‡é›œåº¦ï¼š** ğŸŸ¢ ä½-ä¸­
**ç”¨æˆ¶éœ€æ±‚åº¦ï¼š** ğŸ”´ é«˜
**æŠ€è¡“å¯è¡Œæ€§ï¼š** âœ… é«˜

---

#### 2.1.2 ç”¨æˆ¶æœå°‹ (Users Search) - å„ªå…ˆç´šï¼šâ­â­â­â­
**æœå°‹æ¬„ä½ï¼š**
- `username` - ç”¨æˆ¶åï¼ˆä¸»è¦ï¼‰
- `name` - é¡¯ç¤ºåç¨±ï¼ˆä¸»è¦ï¼‰
- `bio` - å€‹äººç°¡ä»‹ï¼ˆæ¬¡è¦ï¼‰
- `location` - åœ°é»ï¼ˆå¯é¸ï¼‰

**æœå°‹æ¢ä»¶ï¼š**
- é—œéµå­—åŒ¹é…ï¼ˆç”¨æˆ¶åã€åç¨±ã€ç°¡ä»‹ï¼‰
- åœ°é»ç¯©é¸
- ç²‰çµ²æ•¸æ’åº
- æ´»èºåº¦æ’åºï¼ˆç™¼æ–‡æ•¸ã€äº’å‹•æ•¸ï¼‰

**å¯¦ç¾è¤‡é›œåº¦ï¼š** ğŸŸ¢ ä½
**ç”¨æˆ¶éœ€æ±‚åº¦ï¼š** ğŸŸ¡ ä¸­-é«˜
**æŠ€è¡“å¯è¡Œæ€§ï¼š** âœ… é«˜

---

#### 2.1.3 è©•è«–æœå°‹ (Comments Search) - å„ªå…ˆç´šï¼šâ­â­â­
**æœå°‹æ¬„ä½ï¼š**
- `content` - è©•è«–å…§å®¹

**æœå°‹æ¢ä»¶ï¼š**
- é—œéµå­—åŒ¹é…
- ä½œè€…ç¯©é¸
- æ™‚é–“ç¯„åœ
- æŒ‰æ–‡ç« æœå°‹è©•è«–

**å¯¦ç¾è¤‡é›œåº¦ï¼š** ğŸŸ¢ ä½
**ç”¨æˆ¶éœ€æ±‚åº¦ï¼š** ğŸŸ¡ ä¸­
**æŠ€è¡“å¯è¡Œæ€§ï¼š** âœ… é«˜

---

#### 2.1.4 æ¨™ç±¤æœå°‹ (Tags/Hashtags Search) - å„ªå…ˆç´šï¼šâ­â­
**ç•¶å‰ç‹€æ…‹ï¼š** âŒ æ•¸æ“šåº«æ¨¡å‹ä¸­æœªå¯¦ç¾æ¨™ç±¤åŠŸèƒ½
**éœ€æ±‚ï¼š** éœ€è¦å…ˆå¯¦ç¾æ¨™ç±¤ç³»çµ±

**æ‰€éœ€æ–°å¢æ¨¡å‹ï¼š**
```prisma
model Tag {
  id        String   @id @default(uuid())
  name      String   @unique
  count     Int      @default(0)  // ä½¿ç”¨æ¬¡æ•¸
  createdAt DateTime @default(now())
  
  posts     PostTag[]
  
  @@map("tags")
}

model PostTag {
  id        String   @id @default(uuid())
  postId    String
  tagId     String
  createdAt DateTime @default(now())
  
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  
  @@unique([postId, tagId])
  @@index([postId])
  @@index([tagId])
  @@map("post_tags")
}
```

**å¯¦ç¾è¤‡é›œåº¦ï¼š** ğŸŸ¡ ä¸­ï¼ˆéœ€è¦å…ˆå¯¦ç¾æ¨™ç±¤ç³»çµ±ï¼‰
**ç”¨æˆ¶éœ€æ±‚åº¦ï¼š** ğŸŸ¡ ä¸­
**æŠ€è¡“å¯è¡Œæ€§ï¼š** âœ… é«˜ï¼ˆä½†éœ€è¦é¡å¤–é–‹ç™¼ï¼‰

---

### 2.2 æœå°‹åŠŸèƒ½é¡å‹

#### 2.2.1 åŸºç¤æ–‡å­—æœå°‹ï¼ˆç¬¬ä¸€éšæ®µï¼‰- æ¨è–¦å„ªå…ˆå¯¦ç¾
**æŠ€è¡“æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ PostgreSQL çš„ `ILIKE` é€²è¡Œæ¨¡ç³ŠåŒ¹é…
- æ”¯æŒå¤§å°å¯«ä¸æ•æ„Ÿæœå°‹
- ç°¡å–®ã€å¿«é€Ÿã€æ˜“å¯¦ç¾

**å„ªé»ï¼š**
- âœ… å¯¦ç¾ç°¡å–®ï¼Œé–‹ç™¼æˆæœ¬ä½
- âœ… é©åˆå°åˆ°ä¸­å‹æ•¸æ“šé‡ï¼ˆ< 100è¬ç­†è¨˜éŒ„ï¼‰
- âœ… ç¶­è­·æˆæœ¬ä½ï¼Œç„¡éœ€é¡å¤–æœå‹™

**ç¼ºé»ï¼š**
- âš ï¸ æ€§èƒ½éš¨æ•¸æ“šé‡å¢é•·è€Œä¸‹é™
- âš ï¸ ä¸æ”¯æŒè¤‡é›œçš„ç›¸é—œæ€§æ’åº
- âš ï¸ ä¸­æ–‡åˆ†è©æ•ˆæœä¸€èˆ¬

**é©ç”¨å ´æ™¯ï¼š**
- MVP éšæ®µ
- æ•¸æ“šé‡è¼ƒå°æ™‚ï¼ˆ< 10è¬ç­†æ–‡ç« ï¼‰
- éœ€è¦å¿«é€Ÿä¸Šç·šåŸºç¤åŠŸèƒ½

**ç¤ºä¾‹å¯¦ç¾ï¼š**
```typescript
// åŸºç¤ ILIKE æœå°‹
const posts = await prisma.post.findMany({
  where: {
    OR: [
      { title: { contains: keyword, mode: 'insensitive' } },
      { content: { contains: keyword, mode: 'insensitive' } },
    ],
    isPublished: true,
  },
  orderBy: { createdAt: 'desc' },
  take: limit,
  skip: (page - 1) * limit,
});
```

---

#### 2.2.2 å…¨æ–‡æœå°‹ï¼ˆç¬¬äºŒéšæ®µï¼‰
**æŠ€è¡“æ–¹æ¡ˆï¼š**
- PostgreSQL Full-Text Search (FTS)
- ä½¿ç”¨ `tsvector` å’Œ `tsquery`
- æ”¯æŒæ¬Šé‡ã€æ’åå’Œç›¸é—œæ€§è©•åˆ†

**å„ªé»ï¼š**
- âœ… æ€§èƒ½æ›´å¥½ï¼Œæ”¯æŒæ›´å¤§æ•¸æ“šé‡
- âœ… æ”¯æŒç›¸é—œæ€§æ’åº
- âœ… å…§å»ºæ–¼ PostgreSQLï¼Œç„¡éœ€é¡å¤–æœå‹™
- âœ… æ”¯æŒå¤šèªè¨€ï¼ˆåŒ…æ‹¬ä¸­æ–‡ï¼‰

**ç¼ºé»ï¼š**
- âš ï¸ å¯¦ç¾è¼ƒè¤‡é›œï¼Œéœ€è¦é…ç½®
- âš ï¸ éœ€è¦å‰µå»ºé¡å¤–çš„ç´¢å¼•
- âš ï¸ ä¸­æ–‡åˆ†è©éœ€è¦ç‰¹åˆ¥é…ç½®

**é©ç”¨å ´æ™¯ï¼š**
- æ•¸æ“šé‡è¼ƒå¤§æ™‚ï¼ˆ> 10è¬ç­†ï¼‰
- éœ€è¦æ›´å¥½çš„æœå°‹é«”é©—
- éœ€è¦ç›¸é—œæ€§æ’åº

**ç¤ºä¾‹å¯¦ç¾ï¼š**
```sql
-- æ·»åŠ å…¨æ–‡æœå°‹æ¬„ä½
ALTER TABLE posts ADD COLUMN search_vector tsvector;

-- å‰µå»ºç´¢å¼•
CREATE INDEX posts_search_idx ON posts USING gin(search_vector);

-- æ›´æ–°æœå°‹å‘é‡ï¼ˆtriggerï¼‰
CREATE TRIGGER posts_search_vector_update
BEFORE INSERT OR UPDATE ON posts
FOR EACH ROW EXECUTE FUNCTION
tsvector_update_trigger(search_vector, 'pg_catalog.english', title, content);
```

---

#### 2.2.3 é€²éšæœå°‹å¼•æ“ï¼ˆç¬¬ä¸‰éšæ®µï¼‰- å¯é¸
**æŠ€è¡“æ–¹æ¡ˆï¼š**
- Elasticsearch / Meilisearch / Typesense
- å°ˆæ¥­æœå°‹å¼•æ“ï¼ŒåŠŸèƒ½å¼·å¤§

**å„ªé»ï¼š**
- âœ… æ€§èƒ½æ¥µä½³ï¼Œæ”¯æŒæµ·é‡æ•¸æ“š
- âœ… è±å¯Œçš„æœå°‹åŠŸèƒ½ï¼ˆæ¨¡ç³Šæœå°‹ã€åŒç¾©è©ã€æ‹¼éŸ³æœå°‹ï¼‰
- âœ… å‡ºè‰²çš„ä¸­æ–‡åˆ†è©
- âœ… å¯¦æ™‚æœå°‹å»ºè­°
- âœ… é«˜ç´šéæ¿¾å’Œèšåˆ

**ç¼ºé»ï¼š**
- âŒ æ¶æ§‹è¤‡é›œï¼Œç¶­è­·æˆæœ¬é«˜
- âŒ éœ€è¦é¡å¤–æœå‹™å™¨/è³‡æº
- âŒ æ•¸æ“šåŒæ­¥å•é¡Œ
- âŒ å­¸ç¿’æ›²ç·šè¼ƒé™¡

**é©ç”¨å ´æ™¯ï¼š**
- å¤§å‹å¹³å°ï¼ˆ> 100è¬ç”¨æˆ¶ï¼Œ> 1000è¬æ–‡ç« ï¼‰
- éœ€è¦å°ˆæ¥­ç´šæœå°‹é«”é©—
- æœ‰å……è¶³çš„æŠ€è¡“è³‡æº

## 3. æŠ€è¡“å¯¦ç¾æ–¹æ¡ˆ

### 3.1 æ¨è–¦æ–¹æ¡ˆï¼ˆéšæ®µä¸€ï¼šåŸºç¤æœå°‹ï¼‰

#### 3.1.1 å¾Œç«¯å¯¦ç¾

**æ–°å¢è·¯ç”±çµæ§‹ï¼š**
```
GET /api/search?q=keyword&type=posts&page=1&limit=10
GET /api/search/posts?q=keyword&author=userId&sort=latest
GET /api/search/users?q=keyword&sort=followers
GET /api/search/comments?q=keyword&postId=xxx
```

**æ–°å¢ SearchControllerï¼š**
```typescript
// backend/src/search/search.controller.ts
import { Controller, Get, Query } from '@nestjs/common';
import { SearchService } from './search.service';

@Controller('search')
export class SearchController {
  constructor(private readonly searchService: SearchService) {}

  // çµ±ä¸€æœå°‹æ¥å£
  @Get()
  async search(
    @Query('q') query: string,
    @Query('type') type?: 'posts' | 'users' | 'comments' | 'all',
    @Query('page') page?: string,
    @Query('limit') limit?: string,
  ) {
    return this.searchService.search({
      query,
      type: type || 'all',
      page: parseInt(page) || 1,
      limit: parseInt(limit) || 10,
    });
  }

  // å°ˆé–€çš„æ–‡ç« æœå°‹
  @Get('posts')
  async searchPosts(
    @Query('q') query: string,
    @Query('author') authorId?: string,
    @Query('sort') sort?: 'latest' | 'popular' | 'relevant',
    @Query('page') page?: string,
    @Query('limit') limit?: string,
  ) {
    return this.searchService.searchPosts({
      query,
      authorId,
      sort: sort || 'relevant',
      page: parseInt(page) || 1,
      limit: parseInt(limit) || 10,
    });
  }

  // å°ˆé–€çš„ç”¨æˆ¶æœå°‹
  @Get('users')
  async searchUsers(
    @Query('q') query: string,
    @Query('sort') sort?: 'relevant' | 'followers' | 'posts',
    @Query('page') page?: string,
    @Query('limit') limit?: string,
  ) {
    return this.searchService.searchUsers({
      query,
      sort: sort || 'relevant',
      page: parseInt(page) || 1,
      limit: parseInt(limit) || 10,
    });
  }
}
```

**æ–°å¢ SearchServiceï¼š**
```typescript
// backend/src/search/search.service.ts
import { Injectable } from '@nestjs/common';
import { PrismaService } from '../prisma/prisma.service';

@Injectable()
export class SearchService {
  constructor(private prisma: PrismaService) {}

  async searchPosts(params: {
    query: string;
    authorId?: string;
    sort?: 'latest' | 'popular' | 'relevant';
    page: number;
    limit: number;
  }) {
    const { query, authorId, sort, page, limit } = params;
    const skip = (page - 1) * limit;

    const where = {
      isPublished: true,
      ...(authorId && { authorId }),
      OR: [
        { title: { contains: query, mode: 'insensitive' as const } },
        { content: { contains: query, mode: 'insensitive' as const } },
      ],
    };

    // æ’åºé‚è¼¯
    let orderBy: any = { createdAt: 'desc' }; // é»˜èªæœ€æ–°
    if (sort === 'popular') {
      orderBy = [
        { likesCount: 'desc' },
        { commentsCount: 'desc' },
        { createdAt: 'desc' },
      ];
    }

    const [posts, total] = await Promise.all([
      this.prisma.post.findMany({
        where,
        include: {
          author: {
            select: {
              id: true,
              username: true,
              name: true,
              avatar: true,
            },
          },
        },
        orderBy,
        skip,
        take: limit,
      }),
      this.prisma.post.count({ where }),
    ]);

    return {
      success: true,
      message: 'Posts retrieved successfully',
      data: {
        posts,
        pagination: {
          page,
          limit,
          total,
          totalPages: Math.ceil(total / limit),
          hasMore: page * limit < total,
        },
      },
    };
  }

  async searchUsers(params: {
    query: string;
    sort?: 'relevant' | 'followers' | 'posts';
    page: number;
    limit: number;
  }) {
    const { query, sort, page, limit } = params;
    const skip = (page - 1) * limit;

    const where = {
      OR: [
        { username: { contains: query, mode: 'insensitive' as const } },
        { name: { contains: query, mode: 'insensitive' as const } },
        { bio: { contains: query, mode: 'insensitive' as const } },
      ],
    };

    let orderBy: any = { followersCount: 'desc' }; // é»˜èªæŒ‰ç²‰çµ²æ•¸
    if (sort === 'posts') {
      orderBy = { postsCount: 'desc' };
    }

    const [users, total] = await Promise.all([
      this.prisma.user.findMany({
        where,
        select: {
          id: true,
          username: true,
          name: true,
          bio: true,
          avatar: true,
          location: true,
          followersCount: true,
          postsCount: true,
        },
        orderBy,
        skip,
        take: limit,
      }),
      this.prisma.user.count({ where }),
    ]);

    return {
      success: true,
      message: 'Users retrieved successfully',
      data: {
        users,
        pagination: {
          page,
          limit,
          total,
          totalPages: Math.ceil(total / limit),
          hasMore: page * limit < total,
        },
      },
    };
  }

  async search(params: {
    query: string;
    type: 'posts' | 'users' | 'comments' | 'all';
    page: number;
    limit: number;
  }) {
    const { query, type, page, limit } = params;

    if (type === 'posts') {
      return this.searchPosts({ query, page, limit });
    }

    if (type === 'users') {
      return this.searchUsers({ query, page, limit });
    }

    if (type === 'all') {
      // ç¶œåˆæœå°‹ï¼šè¿”å›æ‰€æœ‰é¡å‹çš„çµæœ
      const [posts, users] = await Promise.all([
        this.searchPosts({ query, page: 1, limit: 5 }),
        this.searchUsers({ query, page: 1, limit: 5 }),
      ]);

      return {
        success: true,
        message: 'Search completed successfully',
        data: {
          posts: posts.data.posts,
          users: users.data.users,
          query,
        },
      };
    }
  }
}
```

---

#### 3.1.2 å‰ç«¯å¯¦ç¾

**æ–°å¢æœå°‹æœå‹™ï¼š**
```typescript
// frontend/src/services/search.service.ts
import { apiClient } from './api.client';
import { Post } from '../types/post';
import { User } from '../types/auth';

interface SearchParams {
  query: string;
  type?: 'posts' | 'users' | 'all';
  page?: number;
  limit?: number;
}

interface SearchPostsParams extends SearchParams {
  author?: string;
  sort?: 'latest' | 'popular' | 'relevant';
}

interface SearchUsersParams extends SearchParams {
  sort?: 'relevant' | 'followers' | 'posts';
}

export const searchService = {
  // é€šç”¨æœå°‹
  async search(params: SearchParams) {
    const response = await apiClient.get('/search', { params });
    return response.data;
  },

  // æœå°‹æ–‡ç« 
  async searchPosts(params: SearchPostsParams) {
    const response = await apiClient.get('/search/posts', { params });
    return {
      posts: response.data.posts as Post[],
      pagination: response.data.pagination,
    };
  },

  // æœå°‹ç”¨æˆ¶
  async searchUsers(params: SearchUsersParams) {
    const response = await apiClient.get('/search/users', { params });
    return {
      users: response.data.users as User[],
      pagination: response.data.pagination,
    };
  },
};
```

**æ–°å¢æœå°‹é é¢ï¼š**
```typescript
// frontend/src/screens/SearchScreen.tsx
import React, { useState } from 'react';
import { View, FlatList } from 'react-native';
import { Searchbar, SegmentedButtons, Card } from 'react-native-paper';
import { searchService } from '../services/search.service';
import PostCard from '../components/common/PostCard';

export default function SearchScreen() {
  const [query, setQuery] = useState('');
  const [type, setType] = useState<'posts' | 'users' | 'all'>('posts');
  const [results, setResults] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);

  const handleSearch = async () => {
    if (!query.trim()) return;
    
    setLoading(true);
    try {
      const data = await searchService.search({ query, type });
      setResults(type === 'posts' ? data.posts : data.users);
    } catch (error) {
      console.error('Search error:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <View style={{ flex: 1, padding: 16 }}>
      <Searchbar
        placeholder="æœå°‹æ–‡ç« ã€ç”¨æˆ¶..."
        value={query}
        onChangeText={setQuery}
        onSubmitEditing={handleSearch}
      />
      
      <SegmentedButtons
        value={type}
        onValueChange={(value) => setType(value as any)}
        buttons={[
          { value: 'posts', label: 'æ–‡ç« ' },
          { value: 'users', label: 'ç”¨æˆ¶' },
          { value: 'all', label: 'å…¨éƒ¨' },
        ]}
        style={{ marginVertical: 16 }}
      />

      <FlatList
        data={results}
        renderItem={({ item }) => 
          type === 'posts' ? (
            <PostCard post={item} />
          ) : (
            <Card>
              {/* ç”¨æˆ¶å¡ç‰‡ */}
            </Card>
          )
        }
        keyExtractor={(item) => item.id}
        refreshing={loading}
        onRefresh={handleSearch}
      />
    </View>
  );
}
```

---

### 3.2 æ•¸æ“šåº«å„ªåŒ–

#### 3.2.1 æ·»åŠ ç´¢å¼•ï¼ˆå¿…é ˆï¼‰
```sql
-- ç‚ºæœå°‹å¸¸ç”¨æ¬„ä½æ·»åŠ ç´¢å¼•
CREATE INDEX idx_posts_title ON posts(title);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_name ON users(name);

-- å¾©åˆç´¢å¼•ï¼ˆæå‡æ’åºæ€§èƒ½ï¼‰
CREATE INDEX idx_posts_published_created ON posts(is_published, created_at DESC);
CREATE INDEX idx_posts_published_likes ON posts(is_published, likes_count DESC);
```

#### 3.2.2 Prisma Schema æ›´æ–°
```prisma
model Post {
  // ... ç¾æœ‰æ¬„ä½ ...
  
  @@index([title]) // æ·»åŠ æ¨™é¡Œç´¢å¼•
  @@index([isPublished, createdAt])
  @@index([isPublished, likesCount])
}

model User {
  // ... ç¾æœ‰æ¬„ä½ ...
  
  @@index([username]) // æ·»åŠ ç”¨æˆ¶åç´¢å¼•
  @@index([name]) // æ·»åŠ åç¨±ç´¢å¼•
}
```

---

## 4. å¯¦ç¾å„ªå…ˆç´šå»ºè­°

### éšæ®µä¸€ï¼šMVP åŸºç¤æœå°‹ï¼ˆæ¨è–¦å…ˆå¯¦ç¾ï¼‰
**æ™‚é–“ä¼°è¨ˆï¼š2-3 å¤©**

**åŒ…å«åŠŸèƒ½ï¼š**
- âœ… æ–‡ç« æ¨™é¡Œæœå°‹ï¼ˆILIKEï¼‰
- âœ… ç”¨æˆ¶åæœå°‹ï¼ˆILIKEï¼‰
- âœ… åŸºç¤åˆ†é 
- âœ… ç°¡å–®æ’åºï¼ˆæœ€æ–°ã€ç†±é–€ï¼‰
- âœ… æœå°‹çµæœåˆ—è¡¨é é¢

**é–‹ç™¼ä»»å‹™ï¼š**
1. å¾Œç«¯ï¼šSearchController + SearchServiceï¼ˆ2 å€‹æ–‡ä»¶ï¼‰
2. å‰ç«¯ï¼šSearchScreen + searchServiceï¼ˆ2 å€‹æ–‡ä»¶ï¼‰
3. æ•¸æ“šåº«ï¼šæ·»åŠ åŸºç¤ç´¢å¼•ï¼ˆ1 å€‹ migrationï¼‰
4. æ¸¬è©¦ï¼šAPI æ¸¬è©¦ï¼ˆ1 å€‹æ¸¬è©¦é…ç½®ï¼‰

**å„ªé»ï¼š**
- å¿«é€Ÿä¸Šç·šï¼Œæ»¿è¶³åŸºæœ¬éœ€æ±‚
- å¯¦ç¾ç°¡å–®ï¼Œé¢¨éšªä½
- å¯ä»¥å¿«é€Ÿæ”¶é›†ç”¨æˆ¶åé¥‹

---

### éšæ®µäºŒï¼šå¢å¼·æœå°‹ï¼ˆå¯é¸ï¼‰
**æ™‚é–“ä¼°è¨ˆï¼š3-5 å¤©**

**åŒ…å«åŠŸèƒ½ï¼š**
- âœ… æ–‡ç« å…§å®¹æœå°‹ï¼ˆå…¨æ–‡æœå°‹ï¼‰
- âœ… ç”¨æˆ¶ç°¡ä»‹æœå°‹
- âœ… é«˜ç´šéæ¿¾ï¼ˆä½œè€…ã€æ™‚é–“ç¯„åœã€åˆ†é¡ï¼‰
- âœ… ç›¸é—œæ€§æ’åº
- âœ… æœå°‹æ­·å²è¨˜éŒ„
- âœ… ç†±é–€æœå°‹å»ºè­°

**é–‹ç™¼ä»»å‹™ï¼š**
1. å¾Œç«¯ï¼šå‡ç´šç‚º PostgreSQL Full-Text Search
2. å‰ç«¯ï¼šæ·»åŠ é«˜ç´šæœå°‹ç•Œé¢
3. æ•¸æ“šåº«ï¼šæ·»åŠ å…¨æ–‡ç´¢å¼•
4. å„ªåŒ–ï¼šæ€§èƒ½èª¿å„ª

---

### éšæ®µä¸‰ï¼šå°ˆæ¥­ç´šæœå°‹ï¼ˆæœªä¾†è€ƒæ…®ï¼‰
**æ™‚é–“ä¼°è¨ˆï¼š1-2 é€±**

**åŒ…å«åŠŸèƒ½ï¼š**
- âœ… å³æ™‚æœå°‹å»ºè­°ï¼ˆautocompleteï¼‰
- âœ… æ¨¡ç³Šæœå°‹ï¼ˆæ‹¼å¯«ç³¾éŒ¯ï¼‰
- âœ… åŒç¾©è©æ”¯æŒ
- âœ… æ‹¼éŸ³æœå°‹ï¼ˆä¸­æ–‡ï¼‰
- âœ… æ¨™ç±¤æœå°‹ï¼ˆéœ€å…ˆå¯¦ç¾æ¨™ç±¤ç³»çµ±ï¼‰
- âœ… æœå°‹åˆ†æå’Œçµ±è¨ˆ

**æŠ€è¡“é¸å‹ï¼š**
- Meilisearchï¼ˆæ¨è–¦ï¼Œæ˜“ç”¨ï¼‰
- Elasticsearchï¼ˆåŠŸèƒ½å¼·å¤§ä½†è¤‡é›œï¼‰
- Typesenseï¼ˆè¼•é‡ç´šï¼Œæ€§èƒ½å¥½ï¼‰

---

## 5. æˆæœ¬æ•ˆç›Šåˆ†æ

### 5.1 é–‹ç™¼æˆæœ¬

| éšæ®µ | é–‹ç™¼æ™‚é–“ | æŠ€è¡“é›£åº¦ | ç¶­è­·æˆæœ¬ |
|------|---------|---------|---------|
| éšæ®µä¸€ï¼šåŸºç¤æœå°‹ | 2-3 å¤© | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ |
| éšæ®µäºŒï¼šå¢å¼·æœå°‹ | 3-5 å¤© | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ |
| éšæ®µä¸‰ï¼šå°ˆæ¥­æœå°‹ | 1-2 é€± | ğŸ”´ é«˜ | ğŸ”´ é«˜ |

### 5.2 æ€§èƒ½å½±éŸ¿

**åŸºç¤æœå°‹ï¼ˆILIKEï¼‰ï¼š**
- é©åˆæ•¸æ“šé‡ï¼š< 10è¬ç­†
- æŸ¥è©¢é€Ÿåº¦ï¼š100-500msï¼ˆæœ‰ç´¢å¼•ï¼‰
- è³‡æºæ¶ˆè€—ï¼šä½

**å…¨æ–‡æœå°‹ï¼ˆFTSï¼‰ï¼š**
- é©åˆæ•¸æ“šé‡ï¼š10è¬ - 100è¬ç­†
- æŸ¥è©¢é€Ÿåº¦ï¼š50-200ms
- è³‡æºæ¶ˆè€—ï¼šä¸­ç­‰

**å°ˆæ¥­æœå°‹å¼•æ“ï¼š**
- é©åˆæ•¸æ“šé‡ï¼š> 100è¬ç­†
- æŸ¥è©¢é€Ÿåº¦ï¼š< 50ms
- è³‡æºæ¶ˆè€—ï¼šé«˜ï¼ˆéœ€è¦é¡å¤–æœå‹™å™¨ï¼‰

### 5.3 ç”¨æˆ¶åƒ¹å€¼

**é«˜å„ªå…ˆç´šåŠŸèƒ½ï¼ˆå¿…é ˆï¼‰ï¼š**
- æ–‡ç« æ¨™é¡Œæœå°‹ï¼šâ­â­â­â­â­
- ç”¨æˆ¶åæœå°‹ï¼šâ­â­â­â­

**ä¸­å„ªå…ˆç´šåŠŸèƒ½ï¼ˆé‡è¦ï¼‰ï¼š**
- æ–‡ç« å…§å®¹æœå°‹ï¼šâ­â­â­â­
- é«˜ç´šéæ¿¾ï¼šâ­â­â­
- æœå°‹æ­·å²ï¼šâ­â­â­

**ä½å„ªå…ˆç´šåŠŸèƒ½ï¼ˆåŠ åˆ†é …ï¼‰ï¼š**
- å³æ™‚å»ºè­°ï¼šâ­â­
- æ‹¼éŸ³æœå°‹ï¼šâ­â­
- æ¨™ç±¤æœå°‹ï¼šâ­â­

---

## 6. é¢¨éšªè©•ä¼°

### 6.1 æŠ€è¡“é¢¨éšª

| é¢¨éšªé …ç›® | é¢¨éšªç­‰ç´š | ç·©è§£æªæ–½ |
|---------|---------|---------|
| æœå°‹æ€§èƒ½ä¸‹é™ | ğŸŸ¡ ä¸­ | æ·»åŠ ç´¢å¼•ã€åˆ†é ã€ç·©å­˜ |
| ä¸­æ–‡åˆ†è©æ•ˆæœå·® | ğŸŸ¡ ä¸­ | ä½¿ç”¨å°ˆæ¥­åˆ†è©å™¨ï¼ˆjiebaï¼‰ |
| æ•¸æ“šåº«è² è¼‰å¢åŠ  | ğŸŸ¢ ä½ | è®€å¯«åˆ†é›¢ã€æŸ¥è©¢å„ªåŒ– |
| æœå°‹çµæœä¸æº–ç¢º | ğŸŸ¡ ä¸­ | èª¿æ•´æ¬Šé‡ã€æ·»åŠ ç›¸é—œæ€§æ’åº |

### 6.2 ç”¢å“é¢¨éšª

| é¢¨éšªé …ç›® | é¢¨éšªç­‰ç´š | ç·©è§£æªæ–½ |
|---------|---------|---------|
| ç”¨æˆ¶ä¸ä½¿ç”¨æœå°‹ | ğŸŸ¡ ä¸­ | æ•¸æ“šè¿½è¹¤ã€å„ªåŒ– UI/UX |
| æœå°‹æ¿«ç”¨ï¼ˆspamï¼‰ | ğŸŸ¢ ä½ | é™æµã€é©—è­‰ç¢¼ |
| éš±ç§å•é¡Œ | ğŸŸ¢ ä½ | æœå°‹æ­·å²å¯æ¸…é™¤ã€éš±ç§è¨­ç½® |

---

## 7. å»ºè­°çš„å¯¦ç¾è·¯å¾‘

### 7.1 æ¨è–¦æ–¹æ¡ˆï¼ˆé©åˆç•¶å‰éšæ®µï¼‰

```
é–‹å§‹ â†’ éšæ®µä¸€ï¼ˆåŸºç¤æœå°‹ï¼‰â†’ æ”¶é›†æ•¸æ“šå’Œåé¥‹ â†’ è©•ä¼° â†’ 
      â†“
      éšæ®µäºŒï¼ˆå¢å¼·æœå°‹ï¼‰æˆ– ä¿æŒç¾ç‹€
```

**ç†ç”±ï¼š**
1. ç•¶å‰å¹³å°æ•¸æ“šé‡ä¸å¤§ï¼ŒåŸºç¤æœå°‹è¶³å¤ 
2. å¯¦ç¾å¿«é€Ÿï¼Œå¯ä»¥å¿«é€Ÿé©—è­‰éœ€æ±‚
3. æˆæœ¬ä½ï¼Œé¢¨éšªå¯æ§
4. ç‚ºæœªä¾†å‡ç´šé ç•™ç©ºé–“

### 7.2 ä¸å»ºè­°çš„åšæ³•

âŒ **ç›´æ¥ä¸Šå°ˆæ¥­æœå°‹å¼•æ“**
- éåº¦å·¥ç¨‹åŒ–
- ç¶­è­·æˆæœ¬é«˜
- ç•¶å‰æ•¸æ“šé‡ä¸éœ€è¦

âŒ **åŒæ™‚é–‹ç™¼å¤šç¨®æœå°‹**
- åˆ†æ•£ç²¾åŠ›
- æ¸¬è©¦è¤‡é›œ
- æ•ˆæœä¸ä¸€å®šæ›´å¥½

---

## 8. å¯¦æ–½æª¢æŸ¥æ¸…å–®

### 8.1 é–‹ç™¼å‰æº–å‚™
- [ ] ç¢ºèªç•¶å‰æ•¸æ“šåº«è¡¨çµæ§‹
- [ ] è©•ä¼°ç•¶å‰æ•¸æ“šé‡
- [ ] å®šç¾©æœå°‹éœ€æ±‚å„ªå…ˆç´š
- [ ] é¸æ“‡æŠ€è¡“æ–¹æ¡ˆ
- [ ] è¨­è¨ˆ API æ¥å£

### 8.2 å¾Œç«¯é–‹ç™¼
- [ ] å‰µå»º SearchModuleã€SearchControllerã€SearchService
- [ ] å¯¦ç¾æ–‡ç« æœå°‹ API
- [ ] å¯¦ç¾ç”¨æˆ¶æœå°‹ API
- [ ] æ·»åŠ åˆ†é å’Œæ’åº
- [ ] æ·»åŠ æ•¸æ“šåº«ç´¢å¼•
- [ ] ç·¨å¯« API æ¸¬è©¦
- [ ] æ€§èƒ½æ¸¬è©¦å’Œå„ªåŒ–

### 8.3 å‰ç«¯é–‹ç™¼
- [ ] å‰µå»ºæœå°‹é é¢ UI
- [ ] å¯¦ç¾æœå°‹æœå‹™å±¤
- [ ] æ·»åŠ æœå°‹è¼¸å…¥çµ„ä»¶
- [ ] å¯¦ç¾çµæœåˆ—è¡¨
- [ ] æ·»åŠ éæ¿¾å’Œæ’åº UI
- [ ] è™•ç†åŠ è¼‰å’ŒéŒ¯èª¤ç‹€æ…‹
- [ ] å„ªåŒ–æœå°‹é«”é©—ï¼ˆé˜²æŠ–ã€ç·©å­˜ï¼‰

### 8.4 æ¸¬è©¦é©—è­‰
- [ ] å–®å…ƒæ¸¬è©¦
- [ ] é›†æˆæ¸¬è©¦
- [ ] æ€§èƒ½æ¸¬è©¦
- [ ] ç”¨æˆ¶é«”é©—æ¸¬è©¦
- [ ] é‚Šç•Œæƒ…æ³æ¸¬è©¦

### 8.5 ä¸Šç·šæº–å‚™
- [ ] æ–‡æª”æ›´æ–°
- [ ] API æ–‡æª”
- [ ] ç”¨æˆ¶æŒ‡å—
- [ ] ç›£æ§å’Œæ—¥èªŒ
- [ ] å›æ»¾æ–¹æ¡ˆ

---

## 9. ç¸½çµèˆ‡å»ºè­°

### 9.1 æ ¸å¿ƒå»ºè­°

ğŸ¯ **å»ºè­°å…ˆå¯¦ç¾éšæ®µä¸€ï¼šåŸºç¤æœå°‹**

**åŸå› ï¼š**
1. **æˆæœ¬æ•ˆç›Šé«˜**ï¼š2-3 å¤©é–‹ç™¼æ™‚é–“ï¼Œæ»¿è¶³ 80% ç”¨æˆ¶éœ€æ±‚
2. **é¢¨éšªå¯æ§**ï¼šæŠ€è¡“ç°¡å–®ï¼Œä¸æœƒå½±éŸ¿ç¾æœ‰ç³»çµ±
3. **å¿«é€Ÿé©—è­‰**ï¼šå¯ä»¥å¿«é€Ÿä¸Šç·šæ”¶é›†çœŸå¯¦ç”¨æˆ¶åé¥‹
4. **æ˜“æ–¼è¿­ä»£**ï¼šç‚ºæœªä¾†å‡ç´šé ç•™äº†ç©ºé–“

### 9.2 å¯¦æ–½æ™‚æ©Ÿ

**å»ºè­°åœ¨ä»¥ä¸‹æƒ…æ³å¾Œå†å¯¦æ–½ï¼š**
- âœ… æ ¸å¿ƒåŠŸèƒ½ï¼ˆç™¼æ–‡ã€è©•è«–ã€é»è®šï¼‰å·²ç©©å®š
- âœ… ç”¨æˆ¶é‡é”åˆ°ä¸€å®šè¦æ¨¡ï¼ˆ> 100 æ´»èºç”¨æˆ¶ï¼‰
- âœ… å…§å®¹é‡é”åˆ°ä¸€å®šè¦æ¨¡ï¼ˆ> 1000 ç¯‡æ–‡ç« ï¼‰
- âœ… ç”¨æˆ¶æ˜ç¢ºè¡¨é”æœå°‹éœ€æ±‚

### 9.3 é—œéµæˆåŠŸå› ç´ 

1. **ç°¡å–®é–‹å§‹**ï¼šå¾åŸºç¤åŠŸèƒ½åšèµ·ï¼Œä¸è¦éåº¦è¨­è¨ˆ
2. **æ•¸æ“šé©…å‹•**ï¼šè¿½è¹¤æœå°‹æ•¸æ“šï¼Œäº†è§£ç”¨æˆ¶çœŸå¯¦éœ€æ±‚
3. **æŒçºŒå„ªåŒ–**ï¼šæ ¹æ“šåé¥‹é€æ­¥æ”¹é€²
4. **æ€§èƒ½ç›£æ§**ï¼šç¢ºä¿æœå°‹ä¸å½±éŸ¿æ•´é«”æ€§èƒ½
5. **ç”¨æˆ¶é«”é©—**ï¼šæœå°‹è¦å¿«ã€æº–ã€æ˜“ç”¨

### 9.4 é•·æœŸè¦åŠƒ

```
ç¾åœ¨ï¼ˆMVPï¼‰ â†’ åŸºç¤æœå°‹ â†’ æ•¸æ“šç´¯ç© â†’ éœ€æ±‚æ˜ç¢º â†’ 
               â†“
            å¢å¼·æœå°‹ â†’ æ•¸æ“šé‡å¢é•· â†’ æ€§èƒ½ç“¶é ¸ â†’ 
               â†“
            å°ˆæ¥­æœå°‹å¼•æ“
```

---

## 10. é™„éŒ„

### 10.1 åƒè€ƒè³‡æº

**PostgreSQL å…¨æ–‡æœå°‹ï¼š**
- [å®˜æ–¹æ–‡æª”](https://www.postgresql.org/docs/current/textsearch.html)
- [Prisma Full-Text Search](https://www.prisma.io/docs/concepts/components/prisma-client/full-text-search)

**æœå°‹å¼•æ“ï¼š**
- [Meilisearch](https://www.meilisearch.com/)
- [Elasticsearch](https://www.elastic.co/)
- [Typesense](https://typesense.org/)

**ä¸­æ–‡åˆ†è©ï¼š**
- [jieba](https://github.com/fxsjy/jieba)
- [PostgreSQL zhparser](https://github.com/amutu/zhparser)

### 10.2 ç›¸é—œå•é¡Œ

**Q1ï¼šæœå°‹æœƒå½±éŸ¿ç³»çµ±æ€§èƒ½å—ï¼Ÿ**
Aï¼šé©ç•¶çš„ç´¢å¼•å’Œåˆ†é è¨­è¨ˆä¸‹ï¼Œå½±éŸ¿å¾ˆå°ã€‚å»ºè­°åœ¨ä½å³°æœŸæ¸¬è©¦ã€‚

**Q2ï¼šéœ€è¦å³æ™‚æœå°‹ï¼ˆæœå°‹å»ºè­°ï¼‰å—ï¼Ÿ**
Aï¼šéšæ®µä¸€ä¸å»ºè­°ï¼Œæœƒå¢åŠ è¤‡é›œåº¦ã€‚å¯åœ¨éšæ®µäºŒè€ƒæ…®ã€‚

**Q3ï¼šå¦‚ä½•è™•ç†ä¸­æ–‡æœå°‹ï¼Ÿ**
Aï¼šåŸºç¤ ILIKE å°ä¸­æ–‡æ•ˆæœä¸€èˆ¬ï¼Œå…¨æ–‡æœå°‹éœ€è¦é…ç½®ä¸­æ–‡åˆ†è©å™¨ã€‚

**Q4ï¼šæœå°‹æ­·å²å­˜åœ¨å“ªè£¡ï¼Ÿ**
Aï¼šå»ºè­°å‰ç«¯ LocalStorageï¼Œæˆ–å¾Œç«¯æ•¸æ“šåº«ï¼ˆéœ€è¦æ–°è¡¨ï¼‰ã€‚

**Q5ï¼šè¦ä¸è¦æœå°‹æ•æ„Ÿè©éæ¿¾ï¼Ÿ**
Aï¼šå»ºè­°éšæ®µä¸€ä¸åšï¼Œéšæ®µäºŒå¯ä»¥åŠ å…¥å…§å®¹å¯©æ ¸ã€‚

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** v1.0  
**å‰µå»ºæ—¥æœŸï¼š** 2025-10-29  
**ä½œè€…ï¼š** HAPPY SHARE é–‹ç™¼åœ˜éšŠ  
**ç‹€æ…‹ï¼š** ğŸ“‹ è¦åŠƒä¸­
