# HAPPY SHARE 社交平台開發文件

## 1. 項目描述
HAPPY SHARE 是一個注重分享快樂、正向能量的社交平台，支援網頁版(WEBSITE)、Android及iOS移動應用程式。平台旨在創造一個讓用戶能夠分享生活中美好時刻、互相鼓勵支持的溫暖社群。

## 2. 標準開發流程

### 2.1 需求分析階段
- [ ] 2.1.1 功能需求分析
  - 列出所有功能點
  - 定義用戶角色和權限
  - 確定必要功能和可選功能
- [ ] 2.1.2 技術需求分析
  - 確定技術棧
  - 評估技術可行性
  - 識別潛在技術風險
- [ ] 2.1.3 系統架構設計
  - 制定系統架構圖
  - 定義模組關係
  - 確定技術選型

### 2.2 設計階段
- [ ] 2.2.1 資料庫設計
  - 設計資料模型
  - 定義資料關係
  - 制定資料庫規範
- [ ] 2.2.2 API設計
  - 設計 RESTful API
  - 定義請求/響應格式
  - 制定 API 文檔
- [ ] 2.2.3 UI/UX設計
  - 設計用戶界面
  - 制定設計規範
  - 確定響應式設計方案

### 2.3 開發階段
- [ ] 2.3.1 環境搭建
  - [x] 前端開發環境
    - 使用 Expo 建立 React Native 專案
    - 配置 TypeScript
    - 設置 React Native Paper
    - 配置 Expo 開發環境
  - [ ] 後端開發環境
    - Node.js + Express 設置
    - TypeScript 配置
    - MongoDB 連接
  - [ ] 設置版本控制
- [ ] 2.3.2 後端開發
  - 實現資料模型
  - 開發 API 接口
  - 實現業務邏輯
- [ ] 2.3.3 前端開發
  - 實現用戶界面
  - 對接 API
  - 處理用戶互動

### 2.4 測試階段
- [ ] 2.4.1 單元測試
  - 編寫單元測試
  - 進行代碼覆蓋率測試
- [ ] 2.4.2 整合測試
  - 測試模組間整合
  - 測試第三方服務整合
- [ ] 2.4.3 用戶測試
  - 進行用戶體驗測試
  - 收集用戶反饋

### 2.5 部署階段
- [ ] 2.5.1 環境準備
  - 準備生產環境
  - 配置伺服器
  - 設置域名和SSL
- [ ] 2.5.2 應用部署
  - 部署應用程序
  - 配置負載均衡
  - 設置監控系統
- [ ] 2.5.3 數據遷移
  - 執行數據遷移
  - 驗證數據完整性

### 2.6 維護和優化階段
- [ ] 2.6.1 性能監控
  - 監控系統性能
  - 識別性能瓶頸
  - 進行性能優化
- [ ] 2.6.2 錯誤處理
  - 監控錯誤日誌
  - 處理用戶反饋
  - 修復已知問題
- [ ] 2.6.3 功能迭代
  - 規劃新功能
  - 進行版本更新
  - 維護文檔

## 3. 技術規範

關於主題系統的詳細設計和使用規範，請參考 [主題系統文檔](./主題系統.md)。


### 3.1 技術棧
#### 前端技術棧
- 核心框架與工具：
  - 框架：React Native + Expo
  - 語言：TypeScript
  - 構建工具：Expo CLI
- UI 與導航：
  - UI框架：React Native Paper
  - 導航：React Navigation
  - 響應式設計：React Native 內建 + custom hooks
- 狀態管理與存儲：
  - 狀態管理：Custom Hooks + Context API
  - 本地存儲：@react-native-async-storage/async-storage
  - 表單管理：Custom hooks
- 開發工具：
  - 自動化文檔更新系統
  - TypeScript 類型檢查
  - ESLint + Prettier
  - 自定義驗證工具

#### 後端技術棧（NestJS + Prisma + PostgreSQL）
- 核心框架：
  - 框架：NestJS 11.1.8 (企業級 Node.js 框架)
  - 語言：TypeScript
  - 架構：模塊化、依賴注入、控制反轉
- 數據層：
  - ORM：Prisma 6.18.0 (類型安全的數據庫 ORM)
  - 數據庫：PostgreSQL
    - 開發：Supabase (雲端 PostgreSQL + Session Pooler)
    - 生產：Docker PostgreSQL（計劃）
- 身份驗證與驗證：
  - JWT Token 認證
  - 密碼加密：bcryptjs
  - Passport.js + passport-jwt
  - class-validator (DTO 驗證)
  - class-transformer (類型轉換)
- API：
  - RESTful API (18 個端點)
  - 統一響應格式
  - 全局驗證管道 (ValidationPipe)
  - 全局錯誤處理
- 配置管理：
  - @nestjs/config (環境變數)
  - dotenv 支持
  - 多環境配置

#### DevOps 與部署
- 版本控制：Git + GitHub
- 開發環境：
  - IDE：VS Code
  - 調試工具：React Native Debugger
  - API測試：Postman/Thunder Client
  - 數據庫管理：Prisma Studio
- 生產部署（計劃）：
  - 容器化：Docker + Docker Compose
  - 後端：Docker 容器
  - 數據庫：PostgreSQL Docker 容器
  - 備份策略：自動化腳本 + 定時任務
  - 監控：健康檢查、日誌記錄

## 4. 配置系統
### 4.1 前端配置
配置文件位置：`frontend/src/config/app.config.ts`

#### 4.1.0 測試環境配置
```typescript
export const testAccounts = {
  admin: {
    email: 'admin@happyshare.test',
    password: 'Admin@123',
    username: 'Admin',
    role: 'admin'
  },
  user: {
    email: 'user@happyshare.test',
    password: 'User@123',
    username: 'TestUser',
    role: 'user'
  },
  demo: {
    email: 'demo@happyshare.test',
    password: 'Demo@123',
    username: 'DemoUser',
    role: 'user'
  }
};
```

包含以下配置：
- 應用基礎設定：
  - appName: 'HAPPY SHARE'
  - version: '1.0.0'
  - description: '分享快樂的社交平台'
- 品牌設定：
  - 主題色：
    light: {
      - background: '#FFFFFF'
      - surface: '#F2F2F7'
      - primary: '#000000'
      - secondary: '#FFFFFF'
      - accent: '#007AFF'
      - success: '#34C759'
      - warning: '#FF9500'
      - error: '#FF3B30'
      - text: {
        primary: '#000000',
        secondary: '#3C3C43',
        tertiary: '#787880'
      }
      - gray: {
        100: '#F5F5F5',
        200: '#EEEEEE',
        300: '#E0E0E0',
        400: '#BDBDBD',
        500: '#9E9E9E'
      }
    }
    dark: {
      - background: '#000000'
      - surface: '#1C1C1E'
      - primary: '#FFFFFF'
      - secondary: '#000000'
      - accent: '#0A84FF'
      - success: '#30D158'
      - warning: '#FF9F0A'
      - error: '#FF453A'
      - text: {
        primary: '#FFFFFF',
        secondary: '#EBEBF5',
        tertiary: '#EBEBF599'
      }
      - gray: {
        100: '#1C1C1E',
        200: '#2C2C2E',
        300: '#3A3A3C',
        400: '#48484A',
        500: '#636366'
      }
    }
  - 字型設定：
    - 系統字體：
      - iOS: '-apple-system, SF Pro Display'
      - Android: 'Roboto'
      - Web: 'system-ui'
    - 字重：
      - regular: 400
      - medium: 500
      - semibold: 600
    - 基礎字號：
      - 標題: 34/28/22px
      - 內文: 17px
      - 副文: 15px
      - 標註: 13px
  - 間距規範：
    - 基礎單位：8px
    - 內間距：16/24px
    - 元件間距：8/16/24px
  - 圓角設定：
    - 小: 6px
    - 中: 8px
    - 大: 12px
  - 陰影效果：
    - 淺層: '0 1px 3px rgba(0,0,0,0.1)'
    - 中層: '0 4px 6px rgba(0,0,0,0.1)'
    - 深層: '0 10px 15px rgba(0,0,0,0.1)'
  - 動畫效果：
    - 轉場: 'cubic-bezier(0.4, 0, 0.2, 1)'
    - 時長: 
      - 快: 200ms
      - 中: 300ms
      - 慢: 400ms
- API 設定：
  - baseUrl
  - timeout
- 身份驗證設定：
  - token 存儲鍵
  - refreshToken 存儲鍵
  - token 過期時間
- 驗證規則：
  - 用戶名規則（長度限制）
  - 密碼規則（長度、特殊字符、數字要求）
  - 電子郵件格式驗證

### 4.2 開發工具
#### 4.2.1 驗證工具 (validation.ts)
位置：`frontend/src/utils/validation.ts`
功能：
- 用戶名格式驗證
- 密碼強度檢查
- 電子郵件格式驗證
- 錯誤信息本地化

#### 4.2.2 存儲工具 (storage.ts)
位置：`frontend/src/utils/storage.ts`
功能：
- 身份驗證數據持久化
- Token 管理
- 登入狀態維護
- 自動登入支持

#### 4.2.3 身份驗證服務 (auth.service.ts)
位置：`frontend/src/services/auth.service.ts`
功能：
- 用戶登入
- 用戶註冊
- 登出處理
- 獲取當前用戶信息
- Token 刷新機制

#### 4.2.4 身份驗證 Hook (useAuth.tsx)
位置：`frontend/src/hooks/useAuth.tsx`
功能：
- 提供 AuthContext 和 AuthProvider
- 管理用戶登入狀態
- 處理登入、註冊、登出邏輯
- 自動檢查已保存的認證信息
- 提供 isAuthenticated 狀態供導航使用
- 返回登入結果（success/error）供頁面處理導航

#### 4.2.5 測試登入組件 (TestLogin.tsx)
位置：`frontend/src/components/common/TestLogin.tsx`
功能：
- 提供快速測試帳號登入（管理員、測試用戶、演示帳號）
- 接收 navigation prop 以處理登入後導航
- 顯示登入狀態和載入指示
- 僅在開發環境中顯示
  - 路由：React Router
  - 狀態管理：待定
  - API請求：Axios
- 後端技術棧：
  - 框架：Node.js + Express
  - 語言：TypeScript
  - 數據庫：MongoDB
  - 認證：JWT
- 存儲服務：
  - 檔案存儲：AWS S3
- 開發工具：
  - 版本控制：Git
  - 編輯器：VS Code
  - 調試工具：Chrome DevTools
  - API測試：Postman

### 3.1 開發規範

#### 3.1.0 文檔更新規範
開發過程中必須遵循"即時文檔更新原則"：

1. 何時更新文檔：
   - 添加新功能或組件時
   - 修改現有功能時
   - 更改配置或依賴時
   - 重構代碼時
   - 修復錯誤時
   - 更改API設計時

2. 更新檢查清單：
   ```
   [ ] 功能變更是否已記錄？
   [ ] 配置改動是否已更新？
   [ ] API變更是否已文檔化？
   [ ] 新增依賴是否已列出？
   [ ] 架構變動是否已說明？
   ```

3. 文檔更新位置：
   - 功能更新 → 4. 功能需求
   - 配置變更 → 4. 配置系統
   - API修改 → 6.1 API設計
   - 架構調整 → 3. 系統架構
   - 進度更新 → 5. 開發進度
   - 版本紀錄 → 7. 更新記錄

4. 強制遵循原則：
   - 代碼變更必須同時更新相應文檔
   - 未更新文檔的變更視為未完成
   - 每日工作結束前檢查文檔更新狀態
   - 代碼審查時將文檔更新列為檢查項目

#### 3.1.1 Git 提交規範
- feat: 新功能
- fix: 修復錯誤
- docs: 文檔更新
- style: 代碼格式調整
- refactor: 代碼重構
- test: 測試相關
- chore: 構建過程或輔助工具的變動

#### 3.1.2 代碼規範
1. TypeScript 規範
   - 使用嚴格模式
   - 定義清晰的類型
   - 避免使用 any

2. React 組件規範
   - 使用函數組件
   - 實現錯誤邊界
   - 適當拆分組件

3. API 規範
   - RESTful 設計
   - 統一錯誤處理
   - 請求參數驗證

4. 測試規範
   - 單元測試覆蓋
   - 組件測試
   - API 測試

#### 3.1.3 安全性考慮
- 實現 HTTPS
- 防止 XSS 攻擊
- 防止 SQL 注入
- 數據加密存儲

#### 3.1.4 性能優化
- 代碼分割
- 懶加載
- 緩存策略
- 圖片優化

#### 3.1.5 可維護性
- 詳細文檔
- 代碼註釋
- 日誌記錄
- 模塊化設計

#### 3.1.6 UI/UX 設計規範
1. 設計哲學
   - 簡約優雅：減少視覺雜訊，專注於內容
   - 層次分明：清晰的視覺層級，引導用戶注意力
   - 細緻動態：流暢的微互動，提升使用體驗
   - 一致性：跨平台保持統一的設計語言

2. 佈局原則
   - 充分運用留白，創造優雅簡潔的視覺效果
   - 內容區域採用卡片式設計，清晰分隔
   - 關鍵操作區域放置於易觸及位置
   - 保持垂直和水平對齊

3. 交互設計
   - 手勢操作：
     - 滑動返回
     - 下拉刷新
     - 長按呼出選單
   - 回饋機制：
     - 即時視覺反饋
     - 漸變動畫
     - 觸感反饋（iOS）

4. 可訪問性
   - 支援動態字體大小
   - 高對比度模式
   - VoiceOver/TalkBack 支援
   - 適當的觸控區域大小

5. 組件設計
   - 按鈕：
     - 主要按鈕使用品牌色
     - 次要按鈕使用灰階
     - 圓角風格統一
   - 輸入框：
     - 漂浮標籤設計
     - 即時驗證反饋
     - 錯誤提示整合
   - 列表：
     - 清晰的分隔線
     - 適當的內間距
     - 右側箭頭指示

6. 圖像規範
   - 使用高質量圖片素材
   - 保持圖片比例一致
   - 圖標採用線性設計
   - 適當的圖片壓縮

## 4. 功能需求

### 4.1 用戶管理
#### 4.1.1 身份認證 (已完成)
- [x] 用戶註冊
  - 表單驗證
  - 錯誤處理
  - 自動登入
- [x] 用戶登入
  - 持久化登入狀態
  - Token 管理
  - 自動登入
- [x] 認證流程
  - 導航控制
  - 登入狀態檢查
  - Token 過期處理

#### 4.1.2 用戶資料 (計劃中)
- [ ] 用戶Profile管理
  - 基本資料編輯
  - 頭像上傳
  - 隱私設置
- [ ] 帳號設置
  - 密碼修改
  - 電子郵件驗證
  - 雙因素認證
- [ ] 通知設置
  - 郵件通知
  - 應用內通知
  - 推送通知

### 4.2 文章管理
#### 4.2.1 文章列表功能
- [x] 首頁文章列表
  - 無限滾動載入
  - 文章預覽卡片
  - 文章排序（最新/熱門）
  - 載入狀態指示
  - 下拉重新整理
  - 錯誤處理機制
  - 空白狀態處理

#### 4.2.2 一般用戶功能
- [ ] 發表文章
- [ ] 編輯文章
- [ ] 刪除文章
- [ ] 暫時下架文章
- [ ] 再次上架文章
- [ ] 設置文章回覆權限
- [ ] 設置文章點讚顯示

#### 文章互動功能
- [x] 回覆文章
  - 評論列表顯示
  - 評論發布功能
  - 評論載入更多
  - 評論點讚功能
- [ ] 轉發文章
- [x] 收藏文章
  - 收藏/取消收藏
  - 狀態即時更新
- [x] 點讚文章
  - 點讚/取消點讚
  - 數量即時更新
- [ ] 複製文章連結
- [ ] 舉報文章

#### 文章內容支援
- [ ] 圖片上傳和顯示
- [ ] YouTube影片嵌入
- [ ] 文件上傳和下載（支援格式：WORD, EXCEL, POWERPOINT, JPG, PNG, PDF）

### 4.3 管理員功能
- [ ] 管理所有文章
- [ ] 刪除文章
- [ ] 下架文章
- [ ] 管理文章回覆

## 5. 開發進度

### 5.1 原訂目標
- 第一階段：用戶管理系統和基礎架構（預計完成時間：4週）
- 第二階段：文章發布和基本互動功能（預計完成時間：6週）
- 第三階段：檔案上傳和媒體支援（預計完成時間：4週）
- 第四階段：管理員功能（預計完成時間：2週）
- 第五階段：移動應用開發（預計完成時間：8週）

### 5.2 已完成目標

#### 前端開發 ✅
- **專案基礎架構**
  - 使用 Expo 創建 React Native + TypeScript 專案
  - 配置 React Native Paper (Material Design 3)
  - 實現響應式布局和跨平台支援 (iOS/Android/Web)
  - 建立 ESLint + TypeScript 嚴格模式

- **UI 組件庫**
  - 基礎組件：Button、TextInput、Card、ThemeToggle
  - 布局組件：SafeAreaLayout、HeaderBar
  - 互動組件：PostCard、CommentItem、CommentsList

- **用戶認證系統**
  - 實現登入和註冊頁面
  - 配置認證導航流程 (Stack Navigator)
  - JWT Token 管理 (AsyncStorage)
  - 認證狀態管理 (useAuth Hook)

- **文章功能**
  - 首頁文章列表 (下拉刷新)
  - 文章詳情頁面
  - 創建/編輯文章
  - 點讚和收藏功能
  - 評論系統 (創建、查看、點讚)

- **用戶資料功能**
  - 個人資料頁面
  - 編輯個人資料
  - 用戶文章列表
  - 頭像上傳

- **服務層架構**
  - 策略模式服務層 (API/Mock 雙實現)
  - 統一 API 客戶端 (axios + 攔截器)
  - 開發/生產模式一鍵切換
  - 完整的 DUMMY DATA 系統

#### 後端開發 ✅
- **架構遷移**
  - ✅ 從 Express + MongoDB 遷移到 NestJS + Prisma + PostgreSQL
  - ✅ 模塊化架構設計 (Auth, Users, Posts, Comments)
  - ✅ 依賴注入和控制反轉 (IoC)
  - ✅ 統一響應格式和錯誤處理

- **數據庫設計**
  - ✅ PostgreSQL 關聯式數據庫
  - ✅ Prisma ORM (類型安全)
  - ✅ 5 個數據模型: User, Post, Comment, Like, Bookmark
  - ✅ 數據庫遷移管理
  - ✅ Supabase 雲端數據庫 (開發環境)
  - ✅ Session Pooler 連接池 (解決 WSL IPv6 問題)

- **認證與安全**
  - ✅ JWT Token 認證 (有效期 7 天)
  - ✅ bcryptjs 密碼加密
  - ✅ Passport.js + JWT Strategy
  - ✅ 密碼強度驗證 (class-validator)
    - 最少 8 個字符
    - 必須包含大寫、小寫、數字、特殊字符 (!@#$%^&*)
  - ✅ 全局驗證管道 (ValidationPipe)
  - ✅ 自動 Token 驗證和過期處理

- **RESTful API (18 個端點)**
  - ✅ 認證 API (註冊、登入、當前用戶)
  - ✅ 用戶 API (CRUD、用戶文章、頭像上傳)
  - ✅ 文章 API (CRUD、點讚、收藏、分頁)
  - ✅ 評論 API (CRUD、點讚、文章評論列表)
  - ✅ 所有 API 測試通過

- **服務器配置**
  - ✅ NestJS 11.1.8 框架
  - ✅ CORS 跨域支持
  - ✅ 全局前綴 (/api)
  - ✅ 統一錯誤處理
  - ✅ 環境變數管理 (@nestjs/config)

- **開發工具與測試**
  - ✅ Nest CLI 熱重載 (watch mode)
  - ✅ Prisma Studio (數據庫 GUI)
  - ✅ 測試數據 Seed 腳本 (5 用戶、11 文章、15 評論)
  - ✅ 自動化 API 測試腳本 (Bash)
  - ✅ 通用 API 自動化測試工具 (TypeScript)
    - 基於 JSON 配置的測試框架
    - 支持變數提取和引用
    - 4 種報告格式（控制台、JSON、Markdown、HTML）
    - 可在多個項目中複用
  - ✅ WSL 環境配置和故障排除文檔

#### 測試工具開發 ✅
- **通用 API 自動化測試工具**
  - 位置：`testing-tools/` 目錄
  - 技術棧：TypeScript + axios + commander + chalk
  - 核心功能：
    - JSON 配置驅動的測試執行
    - 變數系統（提取、引用、依賴檢查）
    - 靈活的響應驗證（狀態碼、響應體、響應頭）
    - 多種輸出格式（控制台、JSON、Markdown、HTML）
    - 命令行界面（init、run、validate）
  - HAPPY SHARE 測試覆蓋：
    - 18 個 API 端點測試配置
    - 4 個測試套件（認證、文章、評論、用戶）
    - 自動 token 提取和使用
  - 可複用性：
    - 獨立工具，可複製到任何項目
    - 完整文檔和使用範例
    - 支持自定義配置

#### 文檔和架構 ✅
- 完整的開發文檔 (docs/開發文件.md)
- 後端文檔：
  - README.md (快速開始指南)
  - API_TESTING.md (API 測試指南)
  - MONGODB_SETUP.md (MongoDB 設置 - 已過時)
  - TROUBLESHOOTING.md (WSL IPv6 問題解決)
  - TEST_DATA.md (測試數據說明)
  - PASSWORD_VALIDATION.md (密碼驗證規範)
- 前端文檔：
  - FRONTEND_INTEGRATION.md (前後端集成指南)
  - E2E_TEST_CHECKLIST.md (端到端測試清單)
- 測試工具文檔：
  - testing-tools/README.md (完整使用指南)
  - TESTING_TOOL_GUIDE.md (快速使用指南)
  - examples/happyshare.config.json (測試配置範例)
- 安全文檔：
  - SECURITY.md (安全措施和最佳實踐)
- 遷移文檔：
  - MIGRATION_PLAN.md (遷移計劃和執行記錄)
- 服務層架構說明
- Git 版本控制和 GitHub 集成

### 5.3 未完成目標
- 前端 E2E 測試執行
- API 測試配置優化（部分測試需要調整響應格式驗證）
- 用戶關注系統
- 即時通知功能
- 文件上傳優化 (AWS S3 整合)
- 管理員功能
- 單元測試 (Jest)
- 集成測試擴展
- 性能優化和緩存
- 生產環境部署 (Docker + PostgreSQL)
- CI/CD 管道（可集成測試工具）

### 5.4 正在開發的功能

#### 5.4.1 完整搜尋功能 ⭐⭐⭐⭐⭐ 高優先級 [進行中]
**文檔：** `docs/完整搜尋功能設計方案.md`  
**預計時間：** 6-8 天  
**狀態：** � 開發中（已完成階段 1-2，進行階段 3）

**已完成工作：**

##### ✅ 階段 1：數據模型設計和遷移（0.5 天）
- ✅ 更新 Prisma Schema，添加 4 個新模型：
  - `Attachment` - 文件附件表（filename, originalName, url, mimeType, size）
  - `Tag` - Hashtag 標籤表（name, slug, description, postsCount）
  - `PostTag` - 文章-標籤關聯表（多對多關係）
  - `SearchHistory` - 搜尋歷史表（userId, query, type）
- ✅ 為現有模型添加搜尋索引：
  - User: username, name
  - Post: title, isPublished+likesCount
- ✅ 執行數據庫遷移：`add_search_features`
- ✅ 創建測試數據填充腳本：`prisma/seed-search.ts`
- ✅ 填充測試數據：
  - 10 個標籤（旅遊、美食、科技、生活、攝影、運動、音樂、電影、閱讀、時尚）
  - 19 個文章-標籤關聯
  - 5 個附件（PDF, DOCX, ZIP, PPTX）
  - 8 條搜尋歷史

##### ✅ 階段 2：後端 API 實現（2-3 天）
- ✅ **搜尋引擎抽象層**：
  - 創建 `ISearchEngine` 接口（為未來 Elasticsearch 遷移預留）
  - 實現 `PostgresSearchEngine`（使用 ILIKE 模糊搜尋）
  - 支持文章、用戶、文件、標籤四種類型搜尋
  
- ✅ **SearchModule 完整實現**：
  - `SearchService`：統一搜尋服務層
  - `SearchController`：7 個搜尋端點
  - `OptionalJwtAuthGuard`：可選認證守衛（未登入也可搜尋）
  
- ✅ **TagsModule 完整實現**：
  - `TagsService`：標籤管理邏輯（創建、關聯、統計）
  - `TagsController`：標籤查詢端點（4 個）
  - `PostsTagsController`：文章標籤管理端點（2 個）

- ✅ **API 端點清單（13 個新端點）**：
  - 搜尋相關（7 個）：
    - `GET /api/search` - 綜合搜尋（所有類型）
    - `GET /api/search/posts` - 搜尋文章
    - `GET /api/search/users` - 搜尋用戶
    - `GET /api/search/files` - 搜尋文件
    - `GET /api/search/tags` - 搜尋標籤
    - `GET /api/search/suggestions` - 搜尋建議（自動完成）
    - `GET /api/search/history` - 搜尋歷史
  - 標籤相關（6 個）：
    - `GET /api/tags` - 獲取所有標籤
    - `GET /api/tags/popular` - 熱門標籤
    - `GET /api/tags/:slug` - 標籤詳情
    - `GET /api/tags/:slug/posts` - 標籤下的文章
    - `POST /api/posts/:id/tags` - 為文章添加標籤
    - `DELETE /api/posts/:id/tags/:tagId` - 移除文章標籤

- ✅ **技術特點**：
  - PostgreSQL ILIKE 模糊搜尋（不區分大小寫）
  - 接口抽象設計，支持未來切換到 Elasticsearch
  - 分頁支持（page, limit）
  - 多種排序方式（最新、熱門、相關度）
  - 自動搜尋歷史記錄
  - 搜尋建議（標籤和用戶）

##### ✅ 階段 3：前端 UI 實現（2-3 天）[已完成]
**已完成：**
- ✅ TypeScript 類型定義（`frontend/src/types/search.ts` + `post.ts`）
  - SearchType, SearchParams, Tag, Attachment
  - SearchSuggestion, SearchHistoryItem, Pagination
  - SearchResult, SearchResponse 和其他響應類型
  - Post 類型擴展支持 postTags (Tag[])
- ✅ 搜尋服務層（`frontend/src/services/search.service.ts`）
  - search(), searchPosts(), searchUsers(), searchFiles(), searchTags()
  - getSuggestions(), getHistory()
- ✅ 標籤服務層（`frontend/src/services/tags.service.ts`）
  - getTags(), getPopularTags(), getTag(), getTagPosts()
  - addPostTags(), removePostTag()
- ✅ 搜尋畫面（`frontend/src/screens/SearchScreen.tsx`）
  - 搜尋框和類型標籤切換（全部、文章、用戶、文件、標籤）
  - 搜尋建議（自動完成，最少 2 字符）
  - 搜尋歷史顯示
  - 綜合結果列表（全部類型）
  - 單類型結果列表（支持分頁）
  - 文件搜尋結果展示（使用 FileCard）
- ✅ 標籤文章畫面（`frontend/src/screens/TagPostsScreen.tsx`）
  - 標籤資訊頭部（名稱、描述、文章數）
  - 文章列表（下拉刷新、無限滾動）
- ✅ 通用組件開發：
  - `TagChip.tsx` - 標籤芯片組件（3 種樣式：default, filled, outlined）
  - `TagsList.tsx` - 標籤列表組件（支持橫向滾動、換行、垂直排列）
  - `FileCard.tsx` - 文件卡片組件（文件圖標、大小、上傳者）
- ✅ 服務導出配置（`frontend/src/services/index.ts`）
- ✅ 組件導出配置（`frontend/src/components/common/index.ts`）
- ✅ 導航類型更新（`frontend/src/types/navigation.ts`）
  - 添加 Search 和 TagPosts 路由類型
- ✅ 導航配置更新（`frontend/src/App.tsx`）
  - 添加 Search 和 TagPosts 路由
- ✅ HeaderBar 增強（`components/layout/HeaderBar.tsx`）
  - 添加搜尋圖標入口（showSearch 屬性）
- ✅ 文章標籤集成：
  - `PostDetailScreen.tsx` - 使用 TagsList 顯示文章標籤
  - `CreatePostScreen.tsx` - 完整標籤選擇功能
    * 自定義標籤輸入（2-20 字符驗證）
    * 熱門標籤選擇（載入前 15 個熱門標籤）
    * 最多選擇 5 個標籤限制
    * 標籤芯片即時顯示和移除
  - `EditPostScreen.tsx` - 標籤編輯功能
    * 載入現有標籤
    * 支持添加/移除標籤
    * 與創建頁面相同的選擇器

**技術實現：**
- 使用 React Native Paper MD3 顏色系統
- TypeScript 完整類型支持
- 響應式狀態管理（useState）
- 異步數據加載（async/await）
- 導航參數傳遞（route.params）
- Portal + Modal 模態框
- 標籤驗證邏輯（長度、數量限制）
- 向後兼容舊標籤格式（tags: string[]）

##### ⏳ 階段 4：測試和優化（1 天）[未開始]
**待完成：**
- [ ] API 集成測試
- [ ] 前端功能測試
- [ ] 性能優化
- [ ] 用戶體驗優化

**技術方案：**
- **當前階段**：PostgreSQL ILIKE 模糊搜尋
  - 簡單可靠，無需額外服務
  - 適合初期（< 50,000 篇文章）
  - 對中文支持完美
- **架構設計**：接口抽象，為 Elasticsearch 預留擴展
  - `ISearchEngine` 接口定義 ✅
  - `PostgresSearchEngine` 實現（當前）✅
  - `ElasticsearchEngine` 實現（未來）⏳
  - 一行代碼切換搜尋引擎 ✅

**未來升級路徑：**
- 文章數 > 50,000：升級到 PostgreSQL 全文搜尋
- 文章數 > 500,000：考慮 Elasticsearch
- 需要更強模糊匹配：添加 pg_trgm 擴展

---

### 5.5 計劃將來實行目標

### 5.5 計劃將來實行目標
- **社交功能**
  - 用戶關注/取消關注
  - 關注者/被關注者列表
  - 個人化動態 (只顯示關注用戶的貼文)
  - 用戶搜尋和推薦

- **內容增強**
  - 全文搜尋 (Elasticsearch)
  - Hashtag 支援
  - 多圖片上傳
  - 視頻支援
  - 草稿保存

- **用戶體驗**
  - Pull-to-refresh 優化
  - Infinite scroll (虛擬列表)
  - Skeleton loading
  - Error boundaries
  - Offline 模式

- **技術改進**
  - 即時通知 (WebSocket/Socket.io)
  - 私信系統
  - Redis 緩存
  - 圖片 CDN
  - 日誌分析

- **管理和運維**
  - 管理員後台
  - 數據分析儀表板
  - 用戶行為追蹤
  - 內容審核系統
  - 備份和恢復策略

- **國際化和本地化**
  - 多語言支援 (i18n)
  - 時區處理
  - 貨幣和日期格式化

- **安全增強**
  - Rate limiting (防止暴力破解)
  - HTTPS 強制
  - XSS 和 CSRF 防護
  - 敏感詞過濾
  - 2FA 雙因素認證

## 6. 技術文檔

### 6.1 API設計

#### 6.1.1 文章相關 API

##### 獲取文章列表
```typescript
GET /api/posts

Parameters:
- page: number       // 頁碼，從1開始
- limit: number      // 每頁項目數
- sort: 'latest' | 'popular'  // 排序方式

Response:
{
  posts: Array<{
    id: string;
    title: string;
    content: string;
    author: {
      id: string;
      username: string;
      avatar?: string;
    };
    createdAt: string;
    updatedAt: string;
    likes: number;
    comments: number;
    images?: string[];
    tags?: string[];
  }>;
  pagination: {
    currentPage: number;
    totalPages: number;
    hasMore: boolean;
  };
}
```

##### 模擬響應
```typescript
// 用於開發階段的模擬數據
export const mockPosts = [
  {
    id: '1',
    title: '分享一個快樂的時刻',
    content: '今天是個特別的日子...',
    author: {
      id: '1',
      username: 'Admin',
      avatar: null
    },
    createdAt: '2025-10-26T10:00:00Z',
    updatedAt: '2025-10-26T10:00:00Z',
    likes: 42,
    comments: 5,
    images: [],
    tags: ['日常', '快樂']
  },
  // ... 更多模擬數據
];
```

### 6.2 服務層架構

#### 6.2.1 架構概述

服務層採用**策略模式**設計，實現開發模式和生產模式的無縫切換。

```
frontend/src/services/
├── api.client.ts          # 統一的 API 客戶端（Axios 封裝）
├── *.api.ts               # 真實 API 服務實現
├── *.mock.ts              # Mock 數據服務實現
└── *.service.ts           # 統一服務接口（策略模式）
```

#### 6.2.2 API 客戶端 (api.client.ts)

統一管理所有 HTTP 請求，自動處理：
- 請求攔截：自動添加認證 token
- 響應攔截：統一錯誤處理、token 過期處理
- 基礎配置：baseURL、timeout、headers

```typescript
class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: appConfig.api.baseURL,
      timeout: appConfig.api.timeout,
      headers: { 'Content-Type': 'application/json' },
    });

    // 請求攔截器：自動添加 token
    this.client.interceptors.request.use(async (config) => {
      const auth = await authStorage.getAuth();
      if (auth?.token) {
        config.headers.Authorization = `Bearer ${auth.token}`;
      }
      return config;
    });

    // 響應攔截器：處理 401 錯誤
    this.client.interceptors.response.use(
      (response) => response,
      async (error) => {
        if (error.response?.status === 401) {
          await authStorage.removeAuth();
        }
        return Promise.reject(error);
      }
    );
  }

  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T>
  async post<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T>
  async put<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T>
  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T>
  async patch<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T>
}

export const apiClient = new ApiClient();
```

#### 6.2.3 真實 API 服務 (*.api.ts)

調用真實後端 API 的實現，生產環境使用。

**範例：posts.api.ts**
```typescript
import { apiClient } from './api.client';

export const postsApiService = {
  async createPost(params: CreatePostParams): Promise<Post> {
    return await apiClient.post<Post>('/posts', params);
  },

  async getPosts(params?: PostsQueryParams): Promise<PostsResponse> {
    return await apiClient.get<PostsResponse>('/posts', { params });
  },

  async getPost(id: string): Promise<Post> {
    return await apiClient.get<Post>(`/posts/${id}`);
  },

  async updatePost(id: string, params: Partial<CreatePostParams>): Promise<Post> {
    return await apiClient.put<Post>(`/posts/${id}`, params);
  },

  async deletePost(id: string): Promise<void> {
    await apiClient.delete(`/posts/${id}`);
  },

  async toggleLike(id: string): Promise<Post> {
    return await apiClient.post<Post>(`/posts/${id}/like`);
  },

  async toggleBookmark(id: string): Promise<Post> {
    return await apiClient.post<Post>(`/posts/${id}/bookmark`);
  },
};
```

#### 6.2.4 Mock 數據服務 (*.mock.ts)

使用本地模擬數據的實現，開發環境使用。

**範例：posts.mock.ts**
```typescript
import { dummyPosts, delay } from '../utils/dummyData';

let mockPosts: Post[] = [...dummyPosts];

export const postsMockService = {
  async createPost(params: CreatePostParams): Promise<Post> {
    await delay(); // 模擬網路延遲
    
    const newPost: Post = {
      id: String(mockPosts.length + 1),
      ...params,
      author: { id: '1', username: 'TestUser', avatar: '...' },
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      likes: 0,
      comments: 0,
      isLiked: false,
      isBookmarked: false,
    };

    mockPosts.unshift(newPost);
    return newPost;
  },

  async getPosts(params?: PostsQueryParams): Promise<PostsResponse> {
    await delay();
    
    const page = params?.page || 1;
    const limit = params?.limit || 10;
    const start = (page - 1) * limit;
    const end = start + limit;
    const posts = mockPosts.slice(start, end);

    return {
      posts,
      pagination: {
        currentPage: page,
        totalPages: Math.ceil(mockPosts.length / limit),
        hasMore: page < Math.ceil(mockPosts.length / limit),
      },
    };
  },

  // ... 其他方法實現
};
```

#### 6.2.5 統一服務接口 (*.service.ts)

根據配置自動選擇使用 API 或 Mock 服務。

**範例：posts.service.ts**
```typescript
import { appConfig } from '../config/app.config';
import { postsApiService } from './posts.api';
import { postsMockService } from './posts.mock';

// 策略模式：根據配置選擇服務實現
const getService = () => {
  return appConfig.dev.useDummyData ? postsMockService : postsApiService;
};

export const postsService = {
  async createPost(params: CreatePostParams): Promise<Post> {
    return await getService().createPost(params);
  },

  async getPosts(params?: PostsQueryParams): Promise<PostsResponse> {
    return await getService().getPosts(params);
  },

  // ... 其他方法代理
};
```

#### 6.2.6 切換開發/生產模式

**方法 1：修改配置文件**

編輯 `frontend/src/config/app.config.ts`：

```typescript
const devConfig: AppConfig = {
  dev: {
    useDummyData: true,  // true = Mock 數據，false = 真實 API
  },
  api: {
    baseUrl: 'http://localhost:3000',  // 後端 API 地址
    timeout: 10000,
  },
  // ...
};
```

**方法 2：使用環境變數**（未來實現）

```bash
# .env.development
EXPO_PUBLIC_USE_DUMMY_DATA=true
EXPO_PUBLIC_API_BASE_URL=http://localhost:3000

# .env.production
EXPO_PUBLIC_USE_DUMMY_DATA=false
EXPO_PUBLIC_API_BASE_URL=https://api.happyshare.com
```

#### 6.2.7 服務層最佳實踐

1. **統一接口**：所有服務方法在 API 和 Mock 版本中保持相同簽名
2. **錯誤處理**：Mock 服務應模擬真實 API 的錯誤情況
3. **數據一致性**：Mock 數據結構必須與 API 返回的數據結構完全一致
4. **延遲模擬**：Mock 服務使用 `delay()` 函數模擬網路延遲
5. **類型安全**：所有服務方法都有完整的 TypeScript 類型定義

#### 6.2.8 現有服務列表

| 服務 | API 文件 | Mock 文件 | 統一接口 | 功能 |
|------|----------|-----------|----------|------|
| 文章服務 | `posts.api.ts` | `posts.mock.ts` | `posts.service.ts` | 文章CRUD、點讚、收藏 |
| 用戶服務 | `user.api.ts` | `user.mock.ts` | `user.service.ts` | 個人資料、文章列表、頭像 |
| 互動服務 | (待實現) | `postInteraction.service.ts` | (待重構) | 評論、點讚評論 |
| 認證服務 | `auth.service.ts` | (內含 Mock) | `auth.service.ts` | 登入、註冊、Token |

### 6.3 資料庫結構
待補充

### 6.4 後端 API 架構（NestJS + Prisma）

#### 技術棧
- **NestJS**: 企業級 Node.js 框架
- **Prisma**: 類型安全的 ORM
- **PostgreSQL**: 關聯式數據庫
  - 開發環境：Supabase
  - 生產環境：Docker PostgreSQL
- **JWT + Passport**: 身份驗證
- **bcryptjs**: 密碼加密

#### 項目結構
```
backend/
├── prisma/
│   ├── schema.prisma          # Prisma 數據庫模型
│   └── migrations/            # 數據庫遷移文件
├── src/
│   ├── auth/                  # 認證模塊
│   │   ├── auth.controller.ts # 認證控制器
│   │   ├── auth.service.ts    # 認證服務
│   │   ├── auth.module.ts     # 認證模塊
│   │   ├── jwt.strategy.ts    # JWT 策略
│   │   ├── jwt-auth.guard.ts  # JWT 守衛
│   │   └── dto/               # 數據傳輸對象
│   ├── users/                 # 用戶模塊
│   │   ├── users.controller.ts
│   │   ├── users.service.ts
│   │   ├── users.module.ts
│   │   └── dto/
│   ├── posts/                 # 文章模塊
│   │   ├── posts.controller.ts
│   │   ├── posts.service.ts
│   │   ├── posts.module.ts
│   │   └── dto/
│   ├── comments/              # 評論模塊
│   │   ├── comments.controller.ts
│   │   ├── comments.service.ts
│   │   ├── comments.module.ts
│   │   └── dto/
│   ├── prisma/                # Prisma 服務
│   │   ├── prisma.service.ts  # Prisma 客戶端服務
│   │   └── prisma.module.ts
│   ├── app.module.ts          # 根模塊
│   └── main.ts                # 應用入口
├── .env                       # 環境變數（開發）
├── .env.production.example    # 生產環境配置示例
├── docker-compose.yml         # Docker 配置（生產）
├── Dockerfile                 # Docker 鏡像配置
├── nest-cli.json              # NestJS 配置
├── package.json               # 依賴管理
├── tsconfig.json              # TypeScript 配置
├── README.md                  # 項目說明
└── DATABASE_CONFIG.md         # 數據庫配置指南
```

#### API 端點

**認證 API** (`/api/auth`)
- `POST /register` - 用戶註冊
- `POST /login` - 用戶登入
- `GET /me` - 獲取當前用戶 (需認證)

**用戶 API** (`/api/users`)
- `GET /:id` - 獲取用戶資料
- `PUT /:id` - 更新用戶資料 (需認證)
- `GET /:id/posts` - 獲取用戶的文章
- `POST /avatar` - 上傳頭像 (需認證)

**文章 API** (`/api/posts`)
- `GET /` - 獲取所有文章 (支持分頁)
- `GET /:id` - 獲取單篇文章
- `POST /` - 創建文章 (需認證)
- `PUT /:id` - 更新文章 (需認證)
- `DELETE /:id` - 刪除文章 (需認證)
- `POST /:id/like` - 切換點讚 (需認證)
- `POST /:id/bookmark` - 切換收藏 (需認證)

**評論 API** (`/api/comments`)
- `GET /posts/:postId/comments` - 獲取文章評論
- `POST /posts/:postId/comments` - 創建評論 (需認證)
- `DELETE /:id` - 刪除評論 (需認證)
- `POST /:id/like` - 切換評論點讚 (需認證)

#### 數據庫設計（Prisma Schema）

**User Model**
```prisma
model User {
  id              String    @id @default(uuid())
  username        String    @unique
  email           String    @unique
  password        String
  name            String?
  bio             String?
  avatar          String?
  location        String?
  website         String?
  postsCount      Int       @default(0)
  followersCount  Int       @default(0)
  followingCount  Int       @default(0)
  totalLikes      Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  posts           Post[]
  comments        Comment[]
  likes           Like[]
  bookmarks       Bookmark[]
}
```

**Post Model**
```prisma
model Post {
  id              String    @id @default(uuid())
  title           String
  content         String    @db.Text
  image           String?
  isPublished     Boolean   @default(true)
  likesCount      Int       @default(0)
  commentsCount   Int       @default(0)
  bookmarksCount  Int       @default(0)
  authorId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  author          User      @relation(fields: [authorId], references: [id])
  comments        Comment[]
  likes           Like[]
  bookmarks       Bookmark[]
}
```

**Comment Model**
```prisma
model Comment {
  id         String   @id @default(uuid())
  content    String   @db.Text
  likesCount Int      @default(0)
  authorId   String
  postId     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  author     User     @relation(fields: [authorId], references: [id])
  post       Post     @relation(fields: [postId], references: [id])
  likes      Like[]
}
```

**Like Model** (支持文章和評論)
```prisma
model Like {
  id         String   @id @default(uuid())
  userId     String
  postId     String?
  commentId  String?
  createdAt  DateTime @default(now())
  
  user       User     @relation(fields: [userId], references: [id])
  post       Post?    @relation(fields: [postId], references: [id])
  comment    Comment? @relation(fields: [commentId], references: [id])
  
  @@unique([userId, postId])
  @@unique([userId, commentId])
}
```

**Bookmark Model**
```prisma
model Bookmark {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id])
  post      Post     @relation(fields: [postId], references: [id])
  
  @@unique([userId, postId])
}
```

#### API 響應格式

所有 API 統一使用以下格式：

**成功響應**
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    // 實際數據
  }
}
```

**錯誤響應**
```json
{
  "success": false,
  "message": "錯誤訊息",
  "statusCode": 400
}
```

#### 認證機制

1. **註冊流程**
   - 用戶提交註冊信息
   - 後端驗證數據並檢查重複
   - 使用 bcryptjs 加密密碼
   - 創建用戶並生成 JWT Token
   - 返回用戶信息和 Token

2. **登入流程**
   - 用戶提交登入憑證
   - 查找用戶並驗證密碼
   - 生成 JWT Token (有效期 7 天)
   - 返回用戶信息和 Token

3. **認證守衛 (JwtAuthGuard)**
   - 從 Header 提取 `Authorization: Bearer <token>`
   - 使用 Passport JWT Strategy 驗證 Token
   - 解析 userId 並附加到 `req.user`
   - Token 過期自動返回 401 錯誤

#### 數據庫配置

**開發環境 (Supabase)**
```env
DATABASE_URL="postgresql://postgres.jpcdablvabnuqdmnenqd:FEagle0714@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres"
SUPABASE_URL="https://jpcdablvabnuqdmnenqd.supabase.co"
SUPABASE_ANON_KEY="eyJhbGci..."
```

**生產環境 (Docker PostgreSQL)**
```env
DATABASE_URL="postgresql://postgres:${DB_PASSWORD}@postgres:5432/social_media?schema=public"
```

#### 前後端整合

**前端配置** (`frontend/src/config/app.config.ts`)
```typescript
const devConfig = {
  dev: {
    useDummyData: false,  // 使用真實後端
  },
  api: {
    baseUrl: 'http://localhost:5000',  // 後端地址
    timeout: 10000,
  }
}
```

**啟動步驟**
1. 啟動後端: `cd backend && npm run start:dev`
2. 啟動前端: `cd frontend && npm start`
3. 測試 API: http://localhost:5000/api

#### 開發工具

**Prisma Studio** - 數據庫可視化管理
```bash
cd backend
npx prisma studio
```

**數據庫遷移**
```bash
# 創建遷移
npx prisma migrate dev --name migration_name

# 應用遷移（生產）
npx prisma migrate deploy

# 重置數據庫（開發）
npx prisma migrate reset
```

**生成 Prisma Client**
```bash
npx prisma generate
```

詳細配置請參考: `backend/DATABASE_CONFIG.md`
- 使用 Postman 或類似工具
- 使用前端應用直接測試

### 6.4 通用 API 自動化測試工具

#### 6.4.1 工具概述

項目包含一個功能完整、可在多個項目中複用的 API 自動化測試工具，位於 `testing-tools/` 目錄。

**技術棧**
- TypeScript 5.9.3
- axios 1.7.2 (HTTP 客戶端)
- commander 12.0.0 (命令行接口)
- chalk 4.1.2 (彩色輸出)
- ora 5.4.1 (加載動畫)

#### 6.4.2 核心特性

1. **配置驅動**
   - 基於 JSON 配置文件
   - 無需編寫測試代碼
   - 支持多環境配置

2. **變數系統**
   - 全局變數定義
   - 動態變數提取（從響應中）
   - 變數引用（`{{varName}}`）
   - 依賴檢查

3. **靈活驗證**
   - HTTP 狀態碼驗證
   - 響應體字段驗證（支持嵌套路徑）
   - 響應頭驗證
   - 特殊標記：
     - `{{ANY}}`: 只檢查字段存在
     - `{{NOT_EMPTY}}`: 檢查字段非空

4. **多種報告格式**
   - **控制台**: 實時彩色輸出
   - **JSON**: 結構化數據，便於 CI/CD
   - **Markdown**: 便於文檔化
   - **HTML**: 美觀的網頁報告

#### 6.4.3 項目結構

```
testing-tools/
├── src/
│   ├── types.ts          # TypeScript 類型定義
│   ├── runner.ts         # 測試執行引擎
│   ├── reporter.ts       # 報告生成器
│   ├── cli.ts            # 命令行接口
│   └── index.ts          # 導出接口
├── examples/
│   └── happyshare.config.json  # HAPPY SHARE 測試配置
├── dist/                 # 編譯輸出
├── package.json
├── tsconfig.json
├── .gitignore
└── README.md
```

#### 6.4.4 使用方法

**快速開始**

```bash
# 進入工具目錄
cd testing-tools

# 安裝依賴
npm install

# 運行 HAPPY SHARE 測試
npm run test:example

# 生成 HTML 報告
npx ts-node src/cli.ts run --config examples/happyshare.config.json --output html --file report.html
```

**命令行接口**

```bash
# 初始化配置文件
npm run dev -- init --name "My API" --url "http://localhost:3000/api"

# 運行測試（控制台輸出）
npm run dev -- run

# 運行測試（指定配置）
npm run dev -- run --config my-config.json

# 生成報告
npm run dev -- run --output html --file report.html
npm run dev -- run --output json --file report.json
npm run dev -- run --output markdown --file report.md

# 驗證配置文件
npm run dev -- validate --config my-config.json

# 詳細日誌
npm run dev -- run --verbose
```

#### 6.4.5 配置文件格式

**基本結構**

```json
{
  "projectName": "API 項目名稱",
  "baseUrl": "http://localhost:5000/api",
  "timeout": 30000,
  "verbose": false,
  "globalHeaders": {
    "Content-Type": "application/json"
  },
  "globalVariables": {
    "apiKey": "your-key",
    "testUser": "test@example.com"
  },
  "testSuites": [
    {
      "name": "測試套件名稱",
      "description": "測試套件描述",
      "tests": [...]
    }
  ]
}
```

**測試用例範例**

```json
{
  "name": "用戶登入",
  "description": "測試用戶登入功能",
  "method": "POST",
  "path": "/auth/login",
  "headers": {
    "Custom-Header": "value"
  },
  "body": {
    "email": "{{testEmail}}",
    "password": "{{testPassword}}"
  },
  "expect": {
    "status": 201,
    "body": {
      "success": true,
      "data.token": "{{NOT_EMPTY}}",
      "data.user.email": "{{ANY}}"
    }
  },
  "extract": {
    "token": "data.token",
    "userId": "data.user.id"
  },
  "dependencies": ["testEmail", "testPassword"]
}
```

**變數使用**

```json
{
  "name": "獲取用戶信息",
  "method": "GET",
  "path": "/users/{{userId}}",
  "headers": {
    "Authorization": "Bearer {{token}}"
  },
  "expect": {
    "status": 200
  }
}
```

#### 6.4.6 HAPPY SHARE 測試配置

工具包含完整的 HAPPY SHARE API 測試配置 (`examples/happyshare.config.json`)：

**測試覆蓋** (18 個端點)
- **認證測試** (4 個)
  - 健康檢查
  - 用戶登入（自動提取 token）
  - 獲取當前用戶
  - 未授權訪問驗證
  
- **文章測試** (7 個)
  - 獲取文章列表
  - 獲取單篇文章
  - 創建文章
  - 更新文章
  - 刪除文章
  - 點讚文章
  - 收藏文章
  
- **評論測試** (4 個)
  - 獲取文章評論
  - 創建評論
  - 評論點讚
  - 刪除評論
  
- **用戶測試** (3 個)
  - 獲取用戶信息
  - 獲取用戶文章
  - 更新用戶信息

**測試流程**
1. 健康檢查確認 API 可用
2. 用戶登入並提取 token
3. 使用 token 執行需要認證的操作
4. 測試各種 CRUD 操作
5. 驗證響應格式和數據正確性

#### 6.4.7 報告範例

**控制台輸出**
```
🚀 開始測試項目: HAPPY SHARE API
📍 基礎 URL: http://localhost:5000/api

📦 測試套件: 認證測試
   ✅ 健康檢查 (18ms)
   ✅ 用戶登入 (141ms)
   📝 提取變數: token = eyJhbGc...
   📝 提取變數: userId = 0c65432d...
   ✅ 獲取當前用戶信息 (45ms)
   ✅ 未授權訪問（無 token） (1ms)

============================================================
📊 測試報告: HAPPY SHARE API
============================================================
認證測試: ✅
  總計: 4 | 通過: 4 | 失敗: 0 | 跳過: 0 | 耗時: 205ms

============================================================
📈 總結統計
============================================================
總測試數: 18 | 通過: 18 | 失敗: 0 | 跳過: 0
成功率: 100.00% | 總耗時: 1412ms
執行時間: 1.41s
============================================================

✅ 所有測試通過！
```

**HTML 報告**
- 儀表板顯示總體統計
- 每個套件的詳細結果
- 失敗測試的錯誤信息
- 響應式設計，支持移動設備
- 美觀的視覺效果和顏色編碼

#### 6.4.8 在其他項目中使用

**步驟 1: 複製工具**
```bash
cp -r testing-tools /path/to/your/project/
cd /path/to/your/project/testing-tools
npm install
```

**步驟 2: 創建配置**
```bash
npm run dev -- init --name "Your API" --url "http://localhost:3000/api"
```

**步驟 3: 編輯配置**
編輯生成的 `api-test.config.json`，添加你的測試用例。

**步驟 4: 運行測試**
```bash
npm run dev -- run
```

#### 6.4.9 CI/CD 集成

**GitHub Actions 範例**
```yaml
name: API Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      - name: Install dependencies
        run: |
          cd testing-tools
          npm install
      - name: Run API tests
        run: |
          cd testing-tools
          npm run dev -- run --output json --file results.json
      - name: Upload test results
        uses: actions/upload-artifact@v2
        with:
          name: test-results
          path: testing-tools/results.json
```

#### 6.4.10 相關文檔

- `testing-tools/README.md`: 完整使用指南
- `TESTING_TOOL_GUIDE.md`: 快速使用指南
- `examples/happyshare.config.json`: 實際配置範例

### 6.5 部署架構

#### 開發環境
- **數據庫**: Supabase (PostgreSQL)
- **後端**: 本地運行 NestJS
- **前端**: Expo 開發服務器
- **優勢**: 快速開發、無需本地安裝數據庫

#### 生產環境（計劃）
- **數據庫**: Docker PostgreSQL
- **後端**: Docker 容器化部署
- **前端**: 
  - Web: Vercel/Netlify
  - Mobile: Expo EAS Build
- **優勢**: 完全控制、易於擴展、數據安全

詳細配置請參考: `backend/DATABASE_CONFIG.md`

## 7. 更新記錄
- 2025-10-29: **後端遷移成功啟動** 🎉
  - **資料庫連接成功** ✅
    - 解決 WSL IPv6 連接問題
    - 使用 Supabase Session Pooler (aws-1-ap-southeast-1.pooler.supabase.com:5432)
    - 成功執行 Prisma migrate，創建所有資料表
    - 記錄故障排除方案於 TROUBLESHOOTING.md
  - **後端服務器啟動** ✅
    - 修復 AuthModule 依賴注入問題（添加 ConfigModule）
    - 所有模塊成功初始化
    - 18 個 API 端點全部映射成功
    - 服務運行於 http://localhost:5000/api
  - **文檔完善**
    - SECURITY.md - 完整的安全配置指南
    - TROUBLESHOOTING.md - 故障排除文檔（含 WSL IPv6 問題）
    - SUPABASE_SETUP.md - 更新連接方式說明
    - test-api.sh - API 測試腳本
  - **下一步**
    - [ ] 執行完整 API 測試（test-api.sh）
    - [ ] 前端集成新後端
    - [ ] 端到端功能測試

- 2025-10-29: 完成後端技術棧遷移到 NestJS + Prisma + PostgreSQL
  - **遷移完成** ✅
    - 成功從 Express.js + MongoDB 遷移到 NestJS + Prisma + PostgreSQL
    - 舊代碼保留為 backend-express-reference
    - 新後端位於 backend/ 目錄
  - **技術實現**
    - ✅ 創建 NestJS 項目結構
    - ✅ 配置 Prisma ORM 和 5 個數據模型
    - ✅ 實現 Auth 模塊（註冊、登入、JWT）
    - ✅ 實現 Users 模塊（CRUD、文章列表）
    - ✅ 實現 Posts 模塊（CRUD、點讚、收藏）
    - ✅ 實現 Comments 模塊（CRUD、點讚）
    - ✅ 完成 18 個 API 端點，保持兼容性
    - ✅ 編譯測試通過
  - **數據庫配置**
    - 開發環境：使用 Supabase
      - 項目 ID: jpcdablvabnuqdmnenqd
      - Region: AWS ap-southeast-1
      - 免費方案，無需本地安裝
    - 生產環境：計劃使用 Docker PostgreSQL
      - 創建 docker-compose.yml 配置
      - 創建 Dockerfile 多階段構建
      - 完整的部署和備份策略
  - **文檔完善**
    - backend/README.md - 完整使用指南
    - backend/DATABASE_CONFIG.md - 數據庫配置和遷移指南
    - backend/docker-compose.yml - 生產環境配置
    - backend/Dockerfile - 容器化配置
    - .env.production.example - 生產環境配置模板
  - **技術優勢**
    - 類型安全：完整的 TypeScript 支持
    - 代碼品質：模塊化架構、依賴注入
    - 開發體驗：Prisma Studio、自動生成類型
    - 可擴展性：易於添加新功能和模塊
    - 生產就緒：Docker 部署、健康檢查、監控
- 2025-10-28: 制定後端技術棧遷移計劃
  - **遷移決策**
    - 從 Express.js + MongoDB 遷移到 NestJS + Prisma + PostgreSQL
    - 選擇重建而非遷移現有代碼
    - 保留舊代碼作為參考（backend-express-reference）
  - **技術選型理由**
    - NestJS: 模塊化架構、依賴注入、企業級框架
    - Prisma: 類型安全、自動生成類型、優秀的 DX
    - PostgreSQL: 強關聯查詢、ACID 事務、成熟生態
  - **遷移計劃**
    - 創建詳細的遷移計劃文檔（MIGRATION_PLAN.md）
    - 設計 Prisma Schema（5 個模型）
    - 規劃 4 個 NestJS 模塊（Auth, Users, Posts, Comments）
    - 保持 API 端點兼容性（18 個端點）
    - 預計執行時間：4-5 小時
  - **執行狀態**
    - ✅ 已完成
    - 所有準備工作已完成
    - 詳細步驟和代碼範例已記錄
- 2025-10-28: 實現完整的後端 API 系統
  - **數據庫設計**
    - 使用 MongoDB + Mongoose ODM
    - 5 個數據模型: User, Post, Comment, Like, Bookmark
    - 完善的索引優化和關聯查詢
    - 支持本地 MongoDB 和 MongoDB Atlas
  - **認證系統**
    - JWT Token 認證 (有效期 7 天)
    - bcryptjs 密碼加密 (salt rounds: 10)
    - 認證中間件自動驗證 Token
    - 401 錯誤自動清除過期認證
  - **RESTful API**
    - 認證 API: 註冊、登入、獲取當前用戶
    - 用戶 API: 查看、更新資料、獲取用戶文章、上傳頭像
    - 文章 API: CRUD、點讚、收藏、分頁查詢
    - 評論 API: 創建、刪除、點讚評論
  - **Express 服務器配置**
    - CORS 跨域支持
    - Morgan 請求日誌
    - 統一錯誤處理中間件
    - 404 處理
  - **前端整合**
    - 更新 API baseUrl 指向 localhost:5000
    - posts.api.ts 處理後端響應格式
    - user.api.ts 處理後端響應格式
    - 支持開發/生產模式一鍵切換
  - **文檔和工具**
    - backend/README.md - 完整項目文檔
    - backend/API_TESTING.md - API 測試指南 (PowerShell/cURL)
    - backend/MONGODB_SETUP.md - MongoDB 設置教程 (Atlas/本地/Docker)
    - backend/start-dev.bat - Windows 一鍵啟動腳本
  - **技術亮點**
    - 密碼永不明文存儲
    - Token 自動刷新機制
    - 用戶只能修改/刪除自己的內容
    - 統一的 API 響應格式
    - 完善的數據驗證和錯誤提示
- 2025-10-28: 修復 PostDetailScreen 的 React Hooks 錯誤
  - **問題診斷**
    - 發現 usePostInteraction hook 在條件渲染之後被調用
    - 違反 React Hooks 規則導致運行時錯誤
    - 錯誤訊息：「Rendered more hooks than during the previous render」
  - **修復實施**
    - 將所有 hooks 移到組件最頂層
    - 確保 hooks 在所有條件語句之前調用
    - 刪除重複的 hook 聲明
    - 保證 hooks 調用順序始終一致
  - **遵循最佳實踐**
    - ✅ Hooks 只在組件頂層調用
    - ✅ 不在循環、條件或嵌套函數中調用 Hooks
    - ✅ Hooks 調用順序保持一致
- 2025-10-28: 重構服務層架構（採用策略模式）
  - **創建統一的 API 客戶端**
    - 新增 `api.client.ts` 統一管理所有 HTTP 請求
    - 實現請求/響應攔截器
    - 自動處理認證 token 和錯誤
  - **分離 API 和 Mock 服務**
    - `posts.api.ts` / `posts.mock.ts` - 文章服務的雙重實現
    - `user.api.ts` / `user.mock.ts` - 用戶服務的雙重實現
    - 保持接口一致性，確保無縫切換
  - **更新統一服務接口**
    - 重構 `posts.service.ts` 使用策略模式
    - 重構 `user.service.ts` 使用策略模式
    - 根據 `appConfig.dev.useDummyData` 自動選擇實現
  - **完善開發文檔**
    - 新增「6.2 服務層架構」章節
    - 詳細說明架構設計和切換方式
    - 提供代碼範例和最佳實踐
    - 列出現有服務清單
  - **優化代碼組織**
    - 清晰的分層結構
    - 便於未來接入真實後端 API
    - 降低耦合度，提高可維護性
- 2025-10-27: 實現開發模式使用 DUMMY DATA
  - 新增 `dev.useDummyData` 配置選項
  - 創建完整的 dummy data（用戶、文章、評論）
  - 更新所有服務以支持開發模式
  - 開發期間不再需要啟動後端伺服器
  - 更新 README 添加開發模式說明
- 2025-10-27: 實現用戶個人資料功能
  - 新增 ProfileScreen（個人資料頁面）
  - 新增 EditProfileScreen（編輯個人資料頁面）
  - 實現 user.service.ts 用戶服務
  - 擴展 User 類型定義（bio、location、website、stats）
  - HeaderBar 添加頭像導航按鈕
- 2025-10-27: 修復關鍵導航問題
  - 發現 App.tsx 雙文件問題（root vs src）
  - 修復文件編碼問題（BOM）
  - 確保所有 8 個路由正確註冊
  - 修復登入後自動導航
- 2025-10-26: 優化主題切換功能
  - 簡化 ThemeToggle 組件，專注於 Light/Dark 模式切換
  - 在 HeaderBar 中顯示主題切換按鈕
  - 在 LoginScreen 添加主題切換按鈕
  - 使用太陽和月亮圖標表示淺色/深色模式
  - 添加可選的標籤顯示功能
- 2025-10-26: 實現文章管理功能
  - 新增文章編輯功能（EditPostScreen）
  - 新增文章刪除功能
  - 新增文章發布/取消發布功能
  - 創建 usePostManagement Hook 管理文章操作
  - 更新 PostDetailScreen 添加文章管理菜單
  - 新增 EditPost 路由到導航系統
  - 更新 TextInput 組件支持 placeholder、multiline、disabled 等屬性
  - 更新 Post 類型添加 isPublished 欄位
  - 完善文章服務（posts.service.ts）添加更新、刪除、切換發布狀態的 API
- 2025-10-26: 修復登入導航功能
  - 修復正常登入後無法導航到 HomeScreen 的問題
  - 更新 useAuth hook 以正確管理認證狀態
  - 修復測試帳號快速登入的導航問題
  - 在 LoginScreen 中添加登入成功後的導航邏輯
  - 在 TestLogin 組件中添加導航功能
  - 優化 AuthStorage 介面以匹配 storage.ts 實現
  - 使用 navigation.replace('Home') 防止用戶返回登入頁面
- 2025-10-26: 實現文章互動功能
  - 添加文章點讚功能
  - 添加文章收藏功能
  - 實現評論系統
  - 創建評論相關組件
  - 實現評論點讚功能
  - 整合到文章詳情頁面
- 2025-10-26: 實現首頁文章列表功能
  - 添加無限滾動文章列表
  - 實現文章卡片組件
  - 創建文章相關服務和 Hooks
  - 支援下拉重新整理
  - 添加載入狀態指示
  - 完善錯誤處理機制
- 2025-10-27: 實現用戶個人資料功能
  - 擴展 User 類型，添加 bio、location、website、stats 等欄位
  - 創建 UpdateProfileData 類型用於資料更新
  - 實現 user.service.ts 服務層
    - getUserProfile: 獲取用戶個人資料
    - updateUserProfile: 更新用戶資料
    - getUserPosts: 獲取用戶發布的文章列表
    - uploadAvatar: 上傳用戶頭像
  - 創建 ProfileScreen 個人資料頁面
    - 顯示用戶基本資訊（頭像、用戶名、郵箱）
    - 顯示個人簡介、位置、網站等資訊
    - 顯示統計數據（文章數、粉絲數、關注數、獲讚數）
    - 顯示用戶發布的文章列表（無限滾動）
    - 支援下拉重新整理
    - 提供編輯資料和登出按鈕
  - 創建 EditProfileScreen 編輯資料頁面
    - 編輯用戶名稱、個人簡介、位置、網站
    - 表單驗證
    - 保存後自動更新本地狀態
  - 在 useAuth hook 添加 updateUser 函數
  - 更新導航類型，添加 Profile 和 EditProfile 路由
  - 在 HeaderBar 添加用戶頭像按鈕，點擊進入個人資料頁面
  - 在 App.tsx 添加個人資料相關路由配置
- 2025-10-27: 修復深色模式背景顯示問題
  - 修復 SafeAreaLayout 組件未應用主題背景色的問題
  - 更新 HomeScreen 移除固定顏色，改用動態主題顏色
  - 優化深色模式視覺一致性
  - 確保所有容器組件正確使用 theme.colors.background
- 2025-10-27: 實現文章管理功能
  - 添加文章編輯功能（EditPostScreen）
  - 實現文章刪除功能（含確認對話框）
  - 添加文章發布/取消發布切換功能
  - 建立 usePostManagement hook 統一管理文章操作
  - 更新 PostDetailScreen 添加管理選單
  - 增強 TextInput 組件支援多行文本和禁用狀態
- 2025-10-27: 完成主題切換功能
  - 簡化 ThemeToggle 組件為雙模式切換（淺色/深色）
  - 在 HeaderBar 和 LoginScreen 集成主題切換按鈕
  - 優化主題圖標顯示（太陽/月亮）
  - 支援可選的標籤顯示
- 2025-10-27: 項目上傳至 GitHub
  - 初始化 Git 倉庫
  - 建立完整的 README.md 文檔
  - 上傳至 GitHub 倉庫：LargeEagle/HappySharePatform
  - 建立自動化上傳腳本（upload-to-github.bat 和 .ps1）
- 2025-10-26: 修復測試帳號登入功能
  - 修復登入按鈕的狀態管理問題
  - 改進測試帳號驗證邏輯
  - 修正 User 類型定義，添加 role 字段
  - 優化錯誤處理和日誌記錄
  - 改進開發文檔更新工具
- 2025-10-26: 加入深色模式支援及測試帳號
  - 實現深色/淺色主題切換系統
  - 更新主題配色方案
  - 添加測試帳號配置
  - 建立 useTheme hook
  - 規劃主題切換組件
- 2025-10-26: 採用 Apple 風格設計系統
  - 定義視覺設計規範（顏色、字型、間距等）
  - 建立 UI/UX 設計準則
  - 添加交互設計規範
  - 更新組件設計標準
  - 制定可訪問性準則
- 2025-10-29: 開發通用 API 自動化測試工具
  - **工具特性**
    - 基於 TypeScript + axios 構建
    - JSON 配置驅動，無需編寫測試代碼
    - 變數系統：全局變數、動態提取、變數引用
    - 靈活驗證：狀態碼、響應體（嵌套路徑）、響應頭
    - 特殊驗證標記：`{{ANY}}`（存在檢查）、`{{NOT_EMPTY}}`（非空檢查）
  - **報告格式**
    - 控制台：實時彩色輸出，清晰顯示進度和結果
    - JSON：結構化數據，便於 CI/CD 集成
    - Markdown：便於文檔化和分享
    - HTML：美觀的網頁報告，響應式設計
  - **命令行接口**
    - `init`：初始化配置文件
    - `run`：執行測試套件
    - `validate`：驗證配置文件
    - 支持自定義配置、輸出格式、報告文件
  - **HAPPY SHARE 測試配置**
    - 18 個 API 端點測試
    - 4 個測試套件（認證、文章、評論、用戶）
    - 自動 token 提取和使用
    - 完整的端到端測試流程
  - **可複用性**
    - 工具完全獨立，可複製到任何項目
    - 清晰的文檔和範例配置
    - 支持多項目、多環境配置
  - **文檔**
    - testing-tools/README.md：完整使用指南
    - TESTING_TOOL_GUIDE.md：快速使用指南
    - examples/happyshare.config.json：實際配置範例
- 2025-10-29: 實現密碼強度驗證
  - 安裝 class-validator 和 class-transformer
  - 在 main.ts 添加全局 ValidationPipe
  - 實現密碼驗證規則：
    - 最少 8 個字符
    - 至少一個大寫字母 (A-Z)
    - 至少一個小寫字母 (a-z)
    - 至少一個數字 (0-9)
    - 至少一個特殊字符 (!@#$%^&*)
  - 更新測試數據密碼從 `Password123` 到 `Test@1234`
  - 更新所有相關文檔（TEST_DATA.md、E2E_TEST_CHECKLIST.md）
  - 創建 PASSWORD_VALIDATION.md 詳細說明文檔
  - 驗證功能正常工作（弱密碼被拒絕，強密碼通過）
- 2025-10-29: 完成後端 API 測試
  - 執行 18 個 API 端點測試，全部通過 ✅
  - 測試覆蓋：
    - 認證：註冊、登入、獲取當前用戶
    - 用戶：獲取用戶、更新用戶、獲取用戶文章
    - 文章：CRUD 操作、點讚、收藏、分頁查詢
    - 評論：創建、刪除、點讚、獲取文章評論
  - 創建測試腳本：backend/test-api-simple.sh
  - 所有端點返回正確的響應格式
  - Token 認證正常工作
  - 數據關聯查詢正確
- 2025-10-29: 填充測試數據
  - 創建 Prisma seed 腳本
  - 填充 5 個測試用戶（alice, bob, carol, david, emma）
  - 填充 11 篇文章（10 篇已發布，1 篇草稿）
  - 填充 15 條評論
  - 填充 28 個點讚（20 個文章點讚，8 個評論點讚）
  - 填充 9 個收藏
  - 實現 updateUserStats 函數同步統計數據
  - 創建 TEST_DATA.md 詳細說明測試數據
- 2025-10-29: 解決 WSL IPv6 連接問題
  - 發現 Supabase Direct Connection 使用 IPv6，WSL 不支持
  - 切換到 Supabase Session Pooler（支持 IPv4）
  - 更新 .env 配置使用 Session Pooler 連接字符串
  - 成功執行 Prisma 遷移，創建所有數據表
  - 創建 TROUBLESHOOTING.md 記錄問題和解決方案
- 2025-10-29: 修復 AuthModule 依賴注入問題
  - JwtStrategy 無法解析 ConfigService 依賴
  - 在 AuthModule 的 imports 中添加 ConfigModule
  - 成功解決依賴注入問題
  - 後端服務器正常啟動
- 2025-10-29: 完成 Prisma 數據庫遷移
  - 配置 Prisma 連接 Supabase PostgreSQL
  - 執行 `prisma migrate dev --name init`
  - 成功創建 5 個數據表：User, Post, Comment, Like, Bookmark
  - 生成 Prisma Client
  - 驗證數據庫結構
- 2025-10-29: 完成 NestJS 後端開發
  - 實現 4 個核心模塊：
    - AuthModule：用戶認證（註冊、登入、JWT）
    - UsersModule：用戶管理（CRUD、頭像上傳）
    - PostsModule：文章管理（CRUD、點讚、收藏）
    - CommentsModule：評論管理（CRUD、點讚）
  - 配置 Passport JWT 認證策略
  - 實現統一響應格式
  - 配置 CORS 和全局前綴
  - 集成 Prisma ORM
- 2025-10-29: 設置 NestJS 項目
  - 初始化 NestJS 項目
  - 配置 TypeScript 和 ESLint
  - 安裝必要依賴：
    - @nestjs/passport, @nestjs/jwt
    - @prisma/client, prisma
    - bcryptjs
    - class-validator, class-transformer
  - 配置環境變數管理
  - 設置項目結構
- 2025-10-29: 後端遷移計劃
  - 決定從 Express + MongoDB 遷移到 NestJS + Prisma + PostgreSQL
  - 制定詳細的遷移計劃（MIGRATION_PLAN.md）
  - 選擇 Supabase 作為開發環境的 PostgreSQL 提供商
  - 計劃使用 Docker PostgreSQL 作為生產環境
- 2025-10-28: 前端 API 服務集成
  - 更新 app.config.ts：設置 useDummyData: false
  - 適配 auth.service.ts：
    - 修改 token 提取路徑從 `token` 到 `data.token`
    - 更新用戶數據結構適配後端響應
  - 適配 posts.api.ts：
    - 移除 API 路徑中的重複 `/api` 前綴
    - 更新 toggleLike 和 toggleBookmark 返回完整 Post 對象
  - 創建 FRONTEND_INTEGRATION.md 詳細記錄集成步驟
  - 創建 E2E_TEST_CHECKLIST.md 端到端測試清單
- 2025-10-28: 完成後端安全配置
  - 驗證 .gitignore 包含 .env 文件
  - 創建 .env.example 範本文件
  - 確認敏感數據未提交到 Git 歷史
  - 創建 SECURITY.md 安全文檔
  - 記錄安全最佳實踐
- 2025-10-26: 確立品牌識別
  - 確定專案名稱為 "HAPPY SHARE"
  - 定義品牌主題色系
  - 更新專案描述，強調正向社交理念
  - 在配置系統中加入品牌相關設定
- 2025-10-26: 添加文檔更新規範
  - 建立"即時文檔更新原則"
  - 添加文檔更新檢查清單
  - 明確文檔更新時機和位置
  - 設立強制遵循機制
- 2025-10-26: 建立初始開發文件
- 2025-10-26: 完成前端基礎架構搭建
  - 初始化 Expo + React Native + TypeScript 專案
  - 配置 React Native Paper UI框架
  - 實現 React Navigation 導航系統
  - 添加跨平台支持
  - 設置開發環境和調試工具
- 2025-10-26: 遷移到 React Native 架構
  - 重建前端專案使用 Expo + React Native
  - 建立跨平台共用組件庫
  - 配置 React Native Paper UI框架
  - 實現基礎認證頁面和導航
  - 建立認證相關的型別定義和服務
- 2025-10-26: 實現自動化文檔更新系統
  - 建立 devDocs.ts 自動更新工具
  - 實現 useDocumentationCheck hook 用於追蹤更改
  - 提供標準化的文檔更新格式和示例
  - 整合到開發工作流程中
- 2025-10-26: 架構重大更新
  - 改用 React Native 作為統一前端框架（網頁版和移動應用）
  - 更換 UI 框架從 Tailwind CSS + DaisyUI 到 React Native Paper
  - 統一網頁版和移動版的程式碼基礎

## 8. 最新進展（2025-10-29 晚間）

### 8.1 前後端連接調試成功 ✅

**網絡連接問題解決**
- 問題：前端出現 `ERR_BLOCKED_BY_CLIENT` 和 `ERR_CONNECTION_REFUSED` 錯誤
- 原因分析：
  1. 瀏覽器擴展（廣告攔截器）攔截本地請求
  2. CORS 配置不夠明確
  3. 後端服務器間歇性停止
- 解決方案：
  1. 更新 CORS 配置，明確允許所有來源、方法和憑證
  2. 後端監聽所有接口 `0.0.0.0`，確保可訪問性
  3. 前端配置使用 `localhost` 而非 `127.0.0.1`（瀏覽器兼容性更好）
  4. 添加調試日誌和測試頁面（`frontend/test-api.html`）

**測試帳號配置更新**
- 問題：前端測試帳號與後端數據庫不匹配
- 舊配置：`admin@happyshare.test` / `Admin@123`
- 新配置：`alice@happyshare.com` / `Test@1234`
- 更新文件：
  - `frontend/src/config/app.config.ts` - testAccounts 配置
  - `frontend/src/types/auth.ts` - 添加 `name` 字段

**前端 API 服務調試**
- 在 `auth.service.ts` 添加調試日誌
- 確認 API URL 正確使用 `appConfig.api.baseUrl`
- 驗證登錄流程：前端 → 後端 → 數據庫 ✅

### 8.2 項目級別命令系統 📦

**根目錄 package.json 創建**
- 提供項目級別的統一命令接口
- 簡化多子項目管理

**一鍵啟動命令**
```bash
npm run dev              # 同時啟動前端和後端
npm run dev:backend      # 只啟動後端
npm run dev:frontend     # 只啟動前端
```

**統一測試入口**
```bash
npm run test:api         # 運行 API 測試工具
npm run test:api:html    # 生成 HTML 報告
npm run test:api:json    # 生成 JSON 報告
npm run test:api:markdown # 生成 Markdown 報告
npm run test:health      # 快速健康檢查
npm run test:login       # 快速登錄測試
```

**便捷項目管理**
```bash
npm run setup            # 安裝所有子項目依賴
npm run clean            # 清除所有 node_modules
npm run db:seed          # 填充數據庫
npm run db:migrate       # 執行數據庫遷移
npm run db:studio        # 打開 Prisma Studio
```

**後端專用測試命令**（在 `backend/` 目錄）
```bash
npm run test:api         # 測試 API 健康
npm run test:login       # 測試登錄端點
npm run test:register    # 測試註冊端點
npm run test:posts       # 測試文章列表
npm run prisma:studio    # 打開數據庫管理工具
npm run db:reset         # 重置數據庫（危險）
```

### 8.3 文檔完善 📚

**新增文檔**
1. **QUICK_START.md**
   - 項目快速開始指南
   - 完整的開發流程示例
   - 所有可用命令說明
   - 故障排除指南

2. **backend/TESTING_GUIDE.md**
   - 詳細的測試命令說明
   - API 端點完整列表
   - 測試帳號信息
   - curl 命令示例
   - 故障排除技巧

3. **frontend/test-api.html**
   - 瀏覽器端 API 連接測試工具
   - 可視化測試 localhost 和 127.0.0.1
   - 實時顯示測試結果

**文檔更新**
- backend/package.json - 添加 10+ 測試和數據庫管理命令
- package.json - 根目錄項目級別命令
- 所有文檔統一測試帳號格式和密碼

### 8.4 項目清理 🧹

**刪除舊目錄**
- ❌ `frontend-old/` (147MB) - 舊的 React+Vite web 前端
- ❌ `backend-express-reference/` (18MB) - 舊的 Express+MongoDB 後端
- ✅ 總共釋放約 165MB 空間
- ✅ 所有遷移記錄保留在文檔中
- ✅ Git 歷史中可恢復（如需要）

**項目結構優化**
```
social-media-platform/
├── backend/          ✅ NestJS + Prisma + PostgreSQL
├── frontend/         ✅ React Native + Expo
├── testing-tools/    ✅ 通用 API 測試工具
├── docs/            ✅ 開發文件
├── package.json     ✅ 項目級別命令
└── QUICK_START.md   ✅ 快速開始指南
```

### 8.5 技術棧確認 🔧

**後端（運行中）**
- ✅ NestJS 11.1.8 - 企業級框架
- ✅ Prisma 6.18.0 - 類型安全 ORM
- ✅ PostgreSQL (Supabase) - 關聯數據庫
- ✅ JWT 認證 - 7 天有效期
- ✅ 監聽地址：`http://localhost:5000/api`

**前端（運行中）**
- ✅ React Native + Expo - 跨平台框架
- ✅ React Native Paper - Material Design 3
- ✅ React Navigation - 導航系統
- ✅ Axios - HTTP 客戶端
- ✅ 訪問地址：`http://localhost:8081`

**測試工具**
- ✅ 通用 API 測試工具（TypeScript）
- ✅ 4 種報告格式（Console, JSON, Markdown, HTML）
- ✅ 18 個 API 端點測試配置
- ✅ 變數系統和自動 token 管理

### 8.6 測試數據確認 📊

**5 個測試用戶**（密碼統一：`Test@1234`）
- alice@happyshare.com / alice - Alice Wang
- bob@happyshare.com / bob - Bob Chen
- carol@happyshare.com / carol - Carol Lee
- david@happyshare.com / david - David Liu
- emma@happyshare.com / emma - Emma Wu

**11 篇測試文章**
- 10 篇已發布文章（涵蓋生活、技術、旅行、美食等主題）
- 1 篇草稿文章

**互動數據**
- 15 條評論
- 28 個點讚（20 個文章點讚 + 8 個評論點讚）
- 9 個收藏

### 8.7 當前狀態總覽 ✨

**✅ 已完成**
- [x] 後端遷移到 NestJS + Prisma + PostgreSQL
- [x] 18 個 API 端點開發和測試
- [x] 密碼強度驗證（8+ 字符，大小寫，數字，特殊符號）
- [x] 測試數據填充（5 用戶，11 文章，15 評論）
- [x] 前後端 API 連接調試成功
- [x] 測試帳號配置統一
- [x] 通用 API 測試工具開發
- [x] 項目級別命令系統
- [x] 完整文檔體系（開發、測試、快速開始）
- [x] 項目清理（刪除舊目錄）

**⏳ 進行中**
- [ ] 端到端測試（E2E_TEST_CHECKLIST.md）
- [ ] 前端用戶登錄功能驗證
- [ ] 完整功能流程測試

**🎯 後續計劃**
- [ ] 執行完整的端到端測試
- [ ] 修復發現的前端問題
- [ ] 優化用戶體驗
- [ ] 準備部署配置

### 8.8 關鍵成就 🏆

1. **成功解決前後端連接問題** - 從網絡錯誤到正常 401 認證響應
2. **建立完整的測試體系** - 從單元測試到 E2E 測試
3. **創建可複用的測試工具** - 可用於任何 REST API 項目
4. **實現統一的命令系統** - 簡化開發流程，提升效率
5. **完善文檔體系** - 從快速開始到詳細指南

### 8.9 經驗總結 💡

**網絡調試經驗**
- 使用 `localhost` 優於 `127.0.0.1`（瀏覽器兼容性）
- 明確配置 CORS 而非依賴默認值
- 創建測試頁面快速診斷連接問題
- 添加詳細日誌追蹤請求流程

**項目管理經驗**
- 統一的命令接口減少認知負擔
- 多層次的文檔滿足不同需求（快速開始 vs 詳細指南）
- 測試帳號統一配置避免混亂
- 及時清理舊代碼保持項目整潔

**開發工具經驗**
- 可複用的測試工具提升長期價值
- 多種報告格式滿足不同場景
- 命令行工具需要良好的錯誤提示
- 文檔和示例同等重要

### 8.10 API 路徑配置問題修復（2025-10-29 深夜）🔧

**問題描述**
- 用戶點擊個人資料時出現 404 錯誤
- 錯誤 URL：`http://127.0.0.1:5000/api/api/users/...`（重複的 `/api/` 前綴）
- 影響範圍：所有用戶相關 API 請求

**問題根源分析**
1. **baseURL 配置**：`http://localhost:5000/api`（已包含 `/api`）
2. **service 路徑錯誤**：某些服務方法路徑包含了 `/api/` 前綴
3. **組合結果**：`http://localhost:5000/api` + `/api/users/...` = `http://localhost:5000/api/api/users/...` ❌

**診斷過程**
1. 檢查錯誤日誌，發現 URL 中有重複的 `/api/`
2. 使用 curl 驗證後端端點正常工作：
   ```bash
   curl http://localhost:5000/api/users/{userId}
   # 返回 200 OK，數據正常
   ```
3. 檢查前端代碼：
   - `api.client.ts` - baseURL 配置正確 ✅
   - `user.api.ts` - 發現路徑配置問題 ❌
4. 對比 `posts.api.ts`，確認正確的路徑格式

**修復方案**
1. **代碼檢查**：確認 `user.api.ts` 中所有路徑已移除 `/api/` 前綴
   - `getUserProfile`: `/api/users/${userId}` → `/users/${userId}` ✅
   - `updateUserProfile`: `/api/users/${userId}` → `/users/${userId}` ✅
   - `getUserPosts`: `/api/users/${userId}/posts` → `/users/${userId}/posts` ✅
   - `uploadAvatar`: `/api/users/avatar` → `/users/avatar` ✅

2. **清除緩存**：
   ```bash
   # 清除前端緩存目錄
   rm -rf frontend/.expo frontend/node_modules/.cache
   
   # 停止所有前端進程
   pkill -9 -f "expo|metro"
   
   # 清理端口
   lsof -ti:8081 | xargs kill -9
   ```

3. **重啟服務**：
   ```bash
   # 使用 --clear 參數重啟，清除 Metro bundler 緩存
   cd frontend && npm start -- --clear
   ```

4. **創建測試工具**：
   - 新建 `frontend/test-user-api.html` - 用戶 API 測試工具
   - 提供可視化測試界面
   - 自動檢查 URL 格式正確性
   - 支持 4 種測試場景（獲取用戶、獲取文章、帶 token 測試、URL 格式檢查）

5. **創建 API 路徑指南**：
   - 已有 `frontend/API_PATH_GUIDE.md`
   - 詳細說明正確的 API 路徑配置方式
   - 包含完整的 API 端點映射表
   - 提供調試技巧和檢查清單

**正確的 API 路徑配置規範**
```typescript
// ✅ 正確配置
// app.config.ts
api: {
  baseUrl: 'http://localhost:5000/api',  // baseURL 包含 /api
}

// user.api.ts
async getUserProfile(userId: string) {
  // 路徑不包含 /api/ 前綴
  const response = await apiClient.get(`/users/${userId}`);
  // 實際請求：http://localhost:5000/api/users/{userId} ✅
}

// ❌ 錯誤配置
async getUserProfile(userId: string) {
  // 路徑錯誤地包含了 /api/ 前綴
  const response = await apiClient.get(`/api/users/${userId}`);
  // 實際請求：http://localhost:5000/api/api/users/{userId} ❌
}
```

**驗證方法**
1. **後端驗證**：
   ```bash
   curl http://localhost:5000/api/users/{userId}
   # 應返回 200 OK 和用戶數據
   ```

2. **前端驗證**：
   - 打開 `test-user-api.html` 測試工具
   - 點擊各個測試按鈕
   - 檢查 URL 格式是否正確（無重複 `/api/`）

3. **瀏覽器驗證**：
   - 打開 DevTools → Network 標籤
   - 執行用戶相關操作
   - 檢查請求 URL：
     - ✅ 正確：`http://localhost:5000/api/users/...`
     - ❌ 錯誤：`http://localhost:5000/api/api/users/...`

**瀏覽器緩存問題處理**
- **問題**：代碼已修復，但瀏覽器仍使用舊的 JavaScript bundle
- **解決方案**：
  1. 硬刷新：`Ctrl + Shift + R` (Windows/Linux) 或 `Cmd + Shift + R` (Mac)
  2. 完全清除緩存：
     - 打開 DevTools (F12)
     - Application → Clear storage → Clear site data
     - 關閉並重新打開瀏覽器
  3. 禁用緩存（開發時）：
     - DevTools → Network → 勾選 "Disable cache"
     - 保持 DevTools 開啟

**防止未來出現類似問題**
1. **統一規範**：所有 service 文件路徑不包含 `/api/` 前綴
2. **代碼審查**：檢查新增的 API service 路徑配置
3. **自動化檢查**：
   ```bash
   # 搜索可能有問題的路徑
   grep -r "apiClient.get\(\`/api/" frontend/src/services/
   grep -r "apiClient.post\(\`/api/" frontend/src/services/
   ```
4. **參考文檔**：`frontend/API_PATH_GUIDE.md` 提供完整指南

**修復結果**
- ✅ URL 格式正確：`http://localhost:5000/api/users/...`
- ✅ 後端端點測試通過
- ✅ 前端緩存已清除
- ✅ 測試工具已創建
- ✅ 文檔已完善
- ⏳ 等待用戶刷新瀏覽器驗證

**經驗教訓**
1. **統一配置很重要**：baseURL 包含了什麼，service 路徑就不應該重複
2. **瀏覽器緩存是常見陷阱**：代碼修復後記得清除緩存
3. **對比參考很有效**：對比正常工作的代碼（如 `posts.api.ts`）快速發現問題
4. **測試工具價值高**：可視化測試工具幫助快速診斷問題
5. **文檔防患未然**：詳細的配置指南避免重複犯錯

**相關文件**
- `frontend/src/services/user.api.ts` - 用戶 API 服務（已修復）
- `frontend/src/services/api.client.ts` - API 客戶端配置
- `frontend/src/config/app.config.ts` - 應用配置（baseURL）
- `frontend/test-user-api.html` - 用戶 API 測試工具（新建）
- `frontend/API_PATH_GUIDE.md` - API 路徑配置指南