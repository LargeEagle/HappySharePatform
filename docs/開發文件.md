# HAPPY SHARE 社交平台開發文件

## 1. 項目描述
HAPPY SHARE 是一個注重分享快樂、正向能量的社交平台，支援網頁版(WEBSITE)、Android及iOS移動應用程式。平台旨在創造一個讓用戶能夠分享生活中美好時刻、互相鼓勵支持的溫暖社群。

## 2. 標準開發流程

### 2.1 需求分析階段
- [ ] 2.1.1 功能需求分析
  - 列出所有功能點
  - 定義用戶角色和權限
  - 確定必要功能和可選功能
- [ ] 2.1.2 技術需求分析
  - 確定技術棧
  - 評估技術可行性
  - 識別潛在技術風險
- [ ] 2.1.3 系統架構設計
  - 制定系統架構圖
  - 定義模組關係
  - 確定技術選型

### 2.2 設計階段
- [ ] 2.2.1 資料庫設計
  - 設計資料模型
  - 定義資料關係
  - 制定資料庫規範
- [ ] 2.2.2 API設計
  - 設計 RESTful API
  - 定義請求/響應格式
  - 制定 API 文檔
- [ ] 2.2.3 UI/UX設計
  - 設計用戶界面
  - 制定設計規範
  - 確定響應式設計方案

### 2.3 開發階段
- [ ] 2.3.1 環境搭建
  - [x] 前端開發環境
    - 使用 Expo 建立 React Native 專案
    - 配置 TypeScript
    - 設置 React Native Paper
    - 配置 Expo 開發環境
  - [ ] 後端開發環境
    - Node.js + Express 設置
    - TypeScript 配置
    - MongoDB 連接
  - [ ] 設置版本控制
- [ ] 2.3.2 後端開發
  - 實現資料模型
  - 開發 API 接口
  - 實現業務邏輯
- [ ] 2.3.3 前端開發
  - 實現用戶界面
  - 對接 API
  - 處理用戶互動

### 2.4 測試階段
- [ ] 2.4.1 單元測試
  - 編寫單元測試
  - 進行代碼覆蓋率測試
- [ ] 2.4.2 整合測試
  - 測試模組間整合
  - 測試第三方服務整合
- [ ] 2.4.3 用戶測試
  - 進行用戶體驗測試
  - 收集用戶反饋

### 2.5 部署階段
- [ ] 2.5.1 環境準備
  - 準備生產環境
  - 配置伺服器
  - 設置域名和SSL
- [ ] 2.5.2 應用部署
  - 部署應用程序
  - 配置負載均衡
  - 設置監控系統
- [ ] 2.5.3 數據遷移
  - 執行數據遷移
  - 驗證數據完整性

### 2.6 維護和優化階段
- [ ] 2.6.1 性能監控
  - 監控系統性能
  - 識別性能瓶頸
  - 進行性能優化
- [ ] 2.6.2 錯誤處理
  - 監控錯誤日誌
  - 處理用戶反饋
  - 修復已知問題
- [ ] 2.6.3 功能迭代
  - 規劃新功能
  - 進行版本更新
  - 維護文檔

## 3. 技術規範

關於主題系統的詳細設計和使用規範，請參考 [主題系統文檔](./主題系統.md)。


### 3.1 技術棧
#### 前端技術棧
- 核心框架與工具：
  - 框架：React Native + Expo
  - 語言：TypeScript
  - 構建工具：Expo CLI
- UI 與導航：
  - UI框架：React Native Paper
  - 導航：React Navigation
  - 響應式設計：React Native 內建 + custom hooks
- 狀態管理與存儲：
  - 狀態管理：Custom Hooks + Context API
  - 本地存儲：@react-native-async-storage/async-storage
  - 表單管理：Custom hooks
- 開發工具：
  - 自動化文檔更新系統
  - TypeScript 類型檢查
  - ESLint + Prettier
  - 自定義驗證工具

#### 後端技術棧
- 核心框架：
  - 運行環境：Node.js
  - Web框架：Express
  - 語言：TypeScript
- 數據存儲：
  - 主數據庫：MongoDB
  - 文件存儲：AWS S3 (計劃中)
- 身份驗證：
  - JWT Token 認證
  - 密碼加密：bcrypt
- API：
  - RESTful API
  - OpenAPI/Swagger 文檔

#### DevOps
- 版本控制：Git
- 開發環境：
  - IDE：VS Code
  - 調試工具：React Native Debugger
  - API測試：Postman/Insomnia
- 部署工具：
  - 容器化：Docker (計劃中)
  - CI/CD：GitHub Actions (計劃中)

## 4. 配置系統
### 4.1 前端配置
配置文件位置：`frontend/src/config/app.config.ts`

#### 4.1.0 測試環境配置
```typescript
export const testAccounts = {
  admin: {
    email: 'admin@happyshare.test',
    password: 'Admin@123',
    username: 'Admin',
    role: 'admin'
  },
  user: {
    email: 'user@happyshare.test',
    password: 'User@123',
    username: 'TestUser',
    role: 'user'
  },
  demo: {
    email: 'demo@happyshare.test',
    password: 'Demo@123',
    username: 'DemoUser',
    role: 'user'
  }
};
```

包含以下配置：
- 應用基礎設定：
  - appName: 'HAPPY SHARE'
  - version: '1.0.0'
  - description: '分享快樂的社交平台'
- 品牌設定：
  - 主題色：
    light: {
      - background: '#FFFFFF'
      - surface: '#F2F2F7'
      - primary: '#000000'
      - secondary: '#FFFFFF'
      - accent: '#007AFF'
      - success: '#34C759'
      - warning: '#FF9500'
      - error: '#FF3B30'
      - text: {
        primary: '#000000',
        secondary: '#3C3C43',
        tertiary: '#787880'
      }
      - gray: {
        100: '#F5F5F5',
        200: '#EEEEEE',
        300: '#E0E0E0',
        400: '#BDBDBD',
        500: '#9E9E9E'
      }
    }
    dark: {
      - background: '#000000'
      - surface: '#1C1C1E'
      - primary: '#FFFFFF'
      - secondary: '#000000'
      - accent: '#0A84FF'
      - success: '#30D158'
      - warning: '#FF9F0A'
      - error: '#FF453A'
      - text: {
        primary: '#FFFFFF',
        secondary: '#EBEBF5',
        tertiary: '#EBEBF599'
      }
      - gray: {
        100: '#1C1C1E',
        200: '#2C2C2E',
        300: '#3A3A3C',
        400: '#48484A',
        500: '#636366'
      }
    }
  - 字型設定：
    - 系統字體：
      - iOS: '-apple-system, SF Pro Display'
      - Android: 'Roboto'
      - Web: 'system-ui'
    - 字重：
      - regular: 400
      - medium: 500
      - semibold: 600
    - 基礎字號：
      - 標題: 34/28/22px
      - 內文: 17px
      - 副文: 15px
      - 標註: 13px
  - 間距規範：
    - 基礎單位：8px
    - 內間距：16/24px
    - 元件間距：8/16/24px
  - 圓角設定：
    - 小: 6px
    - 中: 8px
    - 大: 12px
  - 陰影效果：
    - 淺層: '0 1px 3px rgba(0,0,0,0.1)'
    - 中層: '0 4px 6px rgba(0,0,0,0.1)'
    - 深層: '0 10px 15px rgba(0,0,0,0.1)'
  - 動畫效果：
    - 轉場: 'cubic-bezier(0.4, 0, 0.2, 1)'
    - 時長: 
      - 快: 200ms
      - 中: 300ms
      - 慢: 400ms
- API 設定：
  - baseUrl
  - timeout
- 身份驗證設定：
  - token 存儲鍵
  - refreshToken 存儲鍵
  - token 過期時間
- 驗證規則：
  - 用戶名規則（長度限制）
  - 密碼規則（長度、特殊字符、數字要求）
  - 電子郵件格式驗證

### 4.2 開發工具
#### 4.2.1 驗證工具 (validation.ts)
位置：`frontend/src/utils/validation.ts`
功能：
- 用戶名格式驗證
- 密碼強度檢查
- 電子郵件格式驗證
- 錯誤信息本地化

#### 4.2.2 存儲工具 (storage.ts)
位置：`frontend/src/utils/storage.ts`
功能：
- 身份驗證數據持久化
- Token 管理
- 登入狀態維護
- 自動登入支持

#### 4.2.3 身份驗證服務 (auth.service.ts)
位置：`frontend/src/services/auth.service.ts`
功能：
- 用戶登入
- 用戶註冊
- 登出處理
- 獲取當前用戶信息
- Token 刷新機制

#### 4.2.4 身份驗證 Hook (useAuth.tsx)
位置：`frontend/src/hooks/useAuth.tsx`
功能：
- 提供 AuthContext 和 AuthProvider
- 管理用戶登入狀態
- 處理登入、註冊、登出邏輯
- 自動檢查已保存的認證信息
- 提供 isAuthenticated 狀態供導航使用
- 返回登入結果（success/error）供頁面處理導航

#### 4.2.5 測試登入組件 (TestLogin.tsx)
位置：`frontend/src/components/common/TestLogin.tsx`
功能：
- 提供快速測試帳號登入（管理員、測試用戶、演示帳號）
- 接收 navigation prop 以處理登入後導航
- 顯示登入狀態和載入指示
- 僅在開發環境中顯示
  - 路由：React Router
  - 狀態管理：待定
  - API請求：Axios
- 後端技術棧：
  - 框架：Node.js + Express
  - 語言：TypeScript
  - 數據庫：MongoDB
  - 認證：JWT
- 存儲服務：
  - 檔案存儲：AWS S3
- 開發工具：
  - 版本控制：Git
  - 編輯器：VS Code
  - 調試工具：Chrome DevTools
  - API測試：Postman

### 3.1 開發規範

#### 3.1.0 文檔更新規範
開發過程中必須遵循"即時文檔更新原則"：

1. 何時更新文檔：
   - 添加新功能或組件時
   - 修改現有功能時
   - 更改配置或依賴時
   - 重構代碼時
   - 修復錯誤時
   - 更改API設計時

2. 更新檢查清單：
   ```
   [ ] 功能變更是否已記錄？
   [ ] 配置改動是否已更新？
   [ ] API變更是否已文檔化？
   [ ] 新增依賴是否已列出？
   [ ] 架構變動是否已說明？
   ```

3. 文檔更新位置：
   - 功能更新 → 4. 功能需求
   - 配置變更 → 4. 配置系統
   - API修改 → 6.1 API設計
   - 架構調整 → 3. 系統架構
   - 進度更新 → 5. 開發進度
   - 版本紀錄 → 7. 更新記錄

4. 強制遵循原則：
   - 代碼變更必須同時更新相應文檔
   - 未更新文檔的變更視為未完成
   - 每日工作結束前檢查文檔更新狀態
   - 代碼審查時將文檔更新列為檢查項目

#### 3.1.1 Git 提交規範
- feat: 新功能
- fix: 修復錯誤
- docs: 文檔更新
- style: 代碼格式調整
- refactor: 代碼重構
- test: 測試相關
- chore: 構建過程或輔助工具的變動

#### 3.1.2 代碼規範
1. TypeScript 規範
   - 使用嚴格模式
   - 定義清晰的類型
   - 避免使用 any

2. React 組件規範
   - 使用函數組件
   - 實現錯誤邊界
   - 適當拆分組件

3. API 規範
   - RESTful 設計
   - 統一錯誤處理
   - 請求參數驗證

4. 測試規範
   - 單元測試覆蓋
   - 組件測試
   - API 測試

#### 3.1.3 安全性考慮
- 實現 HTTPS
- 防止 XSS 攻擊
- 防止 SQL 注入
- 數據加密存儲

#### 3.1.4 性能優化
- 代碼分割
- 懶加載
- 緩存策略
- 圖片優化

#### 3.1.5 可維護性
- 詳細文檔
- 代碼註釋
- 日誌記錄
- 模塊化設計

#### 3.1.6 UI/UX 設計規範
1. 設計哲學
   - 簡約優雅：減少視覺雜訊，專注於內容
   - 層次分明：清晰的視覺層級，引導用戶注意力
   - 細緻動態：流暢的微互動，提升使用體驗
   - 一致性：跨平台保持統一的設計語言

2. 佈局原則
   - 充分運用留白，創造優雅簡潔的視覺效果
   - 內容區域採用卡片式設計，清晰分隔
   - 關鍵操作區域放置於易觸及位置
   - 保持垂直和水平對齊

3. 交互設計
   - 手勢操作：
     - 滑動返回
     - 下拉刷新
     - 長按呼出選單
   - 回饋機制：
     - 即時視覺反饋
     - 漸變動畫
     - 觸感反饋（iOS）

4. 可訪問性
   - 支援動態字體大小
   - 高對比度模式
   - VoiceOver/TalkBack 支援
   - 適當的觸控區域大小

5. 組件設計
   - 按鈕：
     - 主要按鈕使用品牌色
     - 次要按鈕使用灰階
     - 圓角風格統一
   - 輸入框：
     - 漂浮標籤設計
     - 即時驗證反饋
     - 錯誤提示整合
   - 列表：
     - 清晰的分隔線
     - 適當的內間距
     - 右側箭頭指示

6. 圖像規範
   - 使用高質量圖片素材
   - 保持圖片比例一致
   - 圖標採用線性設計
   - 適當的圖片壓縮

## 4. 功能需求

### 4.1 用戶管理
#### 4.1.1 身份認證 (已完成)
- [x] 用戶註冊
  - 表單驗證
  - 錯誤處理
  - 自動登入
- [x] 用戶登入
  - 持久化登入狀態
  - Token 管理
  - 自動登入
- [x] 認證流程
  - 導航控制
  - 登入狀態檢查
  - Token 過期處理

#### 4.1.2 用戶資料 (計劃中)
- [ ] 用戶Profile管理
  - 基本資料編輯
  - 頭像上傳
  - 隱私設置
- [ ] 帳號設置
  - 密碼修改
  - 電子郵件驗證
  - 雙因素認證
- [ ] 通知設置
  - 郵件通知
  - 應用內通知
  - 推送通知

### 4.2 文章管理
#### 4.2.1 文章列表功能
- [x] 首頁文章列表
  - 無限滾動載入
  - 文章預覽卡片
  - 文章排序（最新/熱門）
  - 載入狀態指示
  - 下拉重新整理
  - 錯誤處理機制
  - 空白狀態處理

#### 4.2.2 一般用戶功能
- [ ] 發表文章
- [ ] 編輯文章
- [ ] 刪除文章
- [ ] 暫時下架文章
- [ ] 再次上架文章
- [ ] 設置文章回覆權限
- [ ] 設置文章點讚顯示

#### 文章互動功能
- [x] 回覆文章
  - 評論列表顯示
  - 評論發布功能
  - 評論載入更多
  - 評論點讚功能
- [ ] 轉發文章
- [x] 收藏文章
  - 收藏/取消收藏
  - 狀態即時更新
- [x] 點讚文章
  - 點讚/取消點讚
  - 數量即時更新
- [ ] 複製文章連結
- [ ] 舉報文章

#### 文章內容支援
- [ ] 圖片上傳和顯示
- [ ] YouTube影片嵌入
- [ ] 文件上傳和下載（支援格式：WORD, EXCEL, POWERPOINT, JPG, PNG, PDF）

### 4.3 管理員功能
- [ ] 管理所有文章
- [ ] 刪除文章
- [ ] 下架文章
- [ ] 管理文章回覆

## 5. 開發進度

### 5.1 原訂目標
- 第一階段：用戶管理系統和基礎架構（預計完成時間：4週）
- 第二階段：文章發布和基本互動功能（預計完成時間：6週）
- 第三階段：檔案上傳和媒體支援（預計完成時間：4週）
- 第四階段：管理員功能（預計完成時間：2週）
- 第五階段：移動應用開發（預計完成時間：8週）

### 5.2 已完成目標
- 專案初始化和文檔建立
- 前端基礎架構搭建：
  - 使用 Expo 創建 React Native + TypeScript 專案
  - 配置 React Native Paper UI框架
  - 實現響應式布局和跨平台支援
  - 建立共用組件庫：
    - 基礎組件：Button、TextInput、Card
    - 布局組件：SafeAreaLayout、HeaderBar
    - 互動組件：CommentItem、CommentsList
  - 建立用戶認證系統基礎架構：
    - 實現登入和註冊頁面
    - 配置認證導航流程
    - 建立認證相關服務和 Hooks
  - 實現文章相關功能：
    - 文章列表頁面
    - 文章詳情頁面
    - 文章點讚功能
    - 文章收藏功能
    - 文章評論系統
    - 評論點讚功能

### 5.3 未完成目標
- 所有功能開發
- 測試和優化
- 部署和發布

### 5.4 計劃將來實行目標
- 社群功能增強（用戶關注、私信等）
- 多語言支援
- 即時通知系統
- 數據分析儀表板
- API效能優化

## 6. 技術文檔

### 6.1 API設計

#### 6.1.1 文章相關 API

##### 獲取文章列表
```typescript
GET /api/posts

Parameters:
- page: number       // 頁碼，從1開始
- limit: number      // 每頁項目數
- sort: 'latest' | 'popular'  // 排序方式

Response:
{
  posts: Array<{
    id: string;
    title: string;
    content: string;
    author: {
      id: string;
      username: string;
      avatar?: string;
    };
    createdAt: string;
    updatedAt: string;
    likes: number;
    comments: number;
    images?: string[];
    tags?: string[];
  }>;
  pagination: {
    currentPage: number;
    totalPages: number;
    hasMore: boolean;
  };
}
```

##### 模擬響應
```typescript
// 用於開發階段的模擬數據
export const mockPosts = [
  {
    id: '1',
    title: '分享一個快樂的時刻',
    content: '今天是個特別的日子...',
    author: {
      id: '1',
      username: 'Admin',
      avatar: null
    },
    createdAt: '2025-10-26T10:00:00Z',
    updatedAt: '2025-10-26T10:00:00Z',
    likes: 42,
    comments: 5,
    images: [],
    tags: ['日常', '快樂']
  },
  // ... 更多模擬數據
];
```

### 6.2 資料庫結構
待補充

### 6.3 部署架構
待補充

## 7. 更新記錄
- 2025-10-26: 優化主題切換功能
  - 簡化 ThemeToggle 組件，專注於 Light/Dark 模式切換
  - 在 HeaderBar 中顯示主題切換按鈕
  - 在 LoginScreen 添加主題切換按鈕
  - 使用太陽和月亮圖標表示淺色/深色模式
  - 添加可選的標籤顯示功能
- 2025-10-26: 實現文章管理功能
  - 新增文章編輯功能（EditPostScreen）
  - 新增文章刪除功能
  - 新增文章發布/取消發布功能
  - 創建 usePostManagement Hook 管理文章操作
  - 更新 PostDetailScreen 添加文章管理菜單
  - 新增 EditPost 路由到導航系統
  - 更新 TextInput 組件支持 placeholder、multiline、disabled 等屬性
  - 更新 Post 類型添加 isPublished 欄位
  - 完善文章服務（posts.service.ts）添加更新、刪除、切換發布狀態的 API
- 2025-10-26: 修復登入導航功能
  - 修復正常登入後無法導航到 HomeScreen 的問題
  - 更新 useAuth hook 以正確管理認證狀態
  - 修復測試帳號快速登入的導航問題
  - 在 LoginScreen 中添加登入成功後的導航邏輯
  - 在 TestLogin 組件中添加導航功能
  - 優化 AuthStorage 介面以匹配 storage.ts 實現
  - 使用 navigation.replace('Home') 防止用戶返回登入頁面
- 2025-10-26: 實現文章互動功能
  - 添加文章點讚功能
  - 添加文章收藏功能
  - 實現評論系統
  - 創建評論相關組件
  - 實現評論點讚功能
  - 整合到文章詳情頁面
- 2025-10-26: 實現首頁文章列表功能
  - 添加無限滾動文章列表
  - 實現文章卡片組件
  - 創建文章相關服務和 Hooks
  - 支援下拉重新整理
  - 添加載入狀態指示
  - 完善錯誤處理機制
- 2025-10-26: 修復測試帳號登入功能
  - 修復登入按鈕的狀態管理問題
  - 改進測試帳號驗證邏輯
  - 修正 User 類型定義，添加 role 字段
  - 優化錯誤處理和日誌記錄
  - 改進開發文檔更新工具
- 2025-10-26: 加入深色模式支援及測試帳號
  - 實現深色/淺色主題切換系統
  - 更新主題配色方案
  - 添加測試帳號配置
  - 建立 useTheme hook
  - 規劃主題切換組件
- 2025-10-26: 採用 Apple 風格設計系統
  - 定義視覺設計規範（顏色、字型、間距等）
  - 建立 UI/UX 設計準則
  - 添加交互設計規範
  - 更新組件設計標準
  - 制定可訪問性準則
- 2025-10-26: 確立品牌識別
  - 確定專案名稱為 "HAPPY SHARE"
  - 定義品牌主題色系
  - 更新專案描述，強調正向社交理念
  - 在配置系統中加入品牌相關設定
- 2025-10-26: 添加文檔更新規範
  - 建立"即時文檔更新原則"
  - 添加文檔更新檢查清單
  - 明確文檔更新時機和位置
  - 設立強制遵循機制
- 2025-10-26: 建立初始開發文件
- 2025-10-26: 完成前端基礎架構搭建
  - 初始化 Expo + React Native + TypeScript 專案
  - 配置 React Native Paper UI框架
  - 實現 React Navigation 導航系統
  - 添加跨平台支持
  - 設置開發環境和調試工具
- 2025-10-26: 遷移到 React Native 架構
  - 重建前端專案使用 Expo + React Native
  - 建立跨平台共用組件庫
  - 配置 React Native Paper UI框架
  - 實現基礎認證頁面和導航
  - 建立認證相關的型別定義和服務
- 2025-10-26: 實現自動化文檔更新系統
  - 建立 devDocs.ts 自動更新工具
  - 實現 useDocumentationCheck hook 用於追蹤更改
  - 提供標準化的文檔更新格式和示例
  - 整合到開發工作流程中
- 2025-10-26: 架構重大更新
  - 改用 React Native 作為統一前端框架（網頁版和移動應用）
  - 更換 UI 框架從 Tailwind CSS + DaisyUI 到 React Native Paper
  - 統一網頁版和移動版的程式碼基礎